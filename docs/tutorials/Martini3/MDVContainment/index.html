<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.34">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>index – Martini Force Field Initiative</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../">
<link href="../../../../images/favicon.png" rel="icon" type="image/png">
<script src="../../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting-c8ad9e5dbd60b7b70b38521ab19b7da4.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../site_libs/bootstrap/bootstrap-bb9c9eaff0dd1107ef27868524499f12.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="../../../../site_libs/quarto-contrib/iconify-2.1.0/iconify-icon.min.js"></script>
<link href="../../../../site_libs/quarto-contrib/fontawesome6-1.2.0/all.min.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-contrib/fontawesome6-1.2.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script>
    document.addEventListener('DOMContentLoaded', (event) => {
      const quotes = [
          "<i>Shaken, not stirred.</i> - James Bond",
          "<i>He was white and shaken, like a dry martini.</i> - P. G. Wodehouse",      
          "<i>I think people think we're all sipping martinis by the pool.</i> - Maria Menounos",
          "<i>Why don't you get out of that wet coat and into a dry martini?</i> - Robert Benchley",
          "<i>Really, can anyone drink several martinis at lunch?</i> - Christine Baranski",
          "<i>Zen martini: A martini with no vermouth at all. And no gin, either.</i> - P.J. O'Rourke",
          "<i>I never go jogging, it makes me spill my martini.</i> - George Burns",
          "<i>Martinis are the only American invention as perfect as a sonnet.</i> - H. L. Mencken",
          "<i>He knows just how I like my martini: full of alcohol.</i> - Homer Simpson",
          "<i>Happiness is: finding olives in your martini when you're hungry.</i> - Johnny Carson",
          "<i>If it wasn't for the olives in his martinis he'd starve to death.</i> - Milton Berle",
        ];
      const randomIndex = Math.floor(Math.random() * quotes.length);
      const randomQuote = quotes[randomIndex];

      const footerLeft = document.querySelector('.footer-left');
      if (footerLeft) {
          footerLeft.innerHTML = randomQuote;
      }
    });
</script>


<link rel="stylesheet" href="../../../../styles.css">
<meta property="og:title" content="Martini Force Field Initiative">
<meta property="og:description" content="">
<meta property="og:image" content="https://cgmartini.nl/docs/tutorials/Martini3/MDVContainment/containment_examples.png">
<meta property="og:site_name" content="Martini Force Field Initiative">
<meta property="og:image:height" content="755">
<meta property="og:image:width" content="776">
<meta name="twitter:title" content="Martini Force Field Initiative">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://cgmartini.nl/docs/tutorials/Martini3/MDVContainment/containment_examples.png">
<meta name="twitter:image-height" content="755">
<meta name="twitter:image-width" content="776">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../../images/martini.gif" alt="martini logo" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../index.html"> <i class="bi bi-house-fill" role="img">
</i> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../../../../docs/tutorials/index.html" aria-current="page"> <i class="bi bi-mortarboard-fill" role="img">
</i> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../docs/downloads/index.html"> <i class="bi bi-download" role="img">
</i> 
<span class="menu-text">Downloads</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../docs/publications/index.html"> <i class="bi bi-newspaper" role="img">
</i> 
<span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../docs/announcements/index.html"> 
<span class="menu-text"><i class="fa-solid fa-bullhorn" aria-label="bullhorn"></i> Announcements</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../docs/contact/index.html"> 
<span class="menu-text"><i class="fa-regular fa-address-book" aria-label="address-book"></i> Contact</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-fa-circle-info--help" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text"><i class="fa-solid fa-circle-info" aria-label="circle-info"></i> Help</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-fa-circle-info--help">    
        <li>
    <a class="dropdown-item" href="https://github.com/orgs/Martini-Force-Field-Initiative/discussions"><i class="bi bi-chat-right-text" role="img">
</i> 
 <span class="dropdown-text">Discussion Board</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/orgs/Martini-Force-Field-Initiative/discussions"><i class="bi bi-bug" role="img">
</i> 
 <span class="dropdown-text">Report an Issue</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../docs/faq/index.html"><i class="bi bi-question-circle" role="img">
</i> 
 <span class="dropdown-text">FAQs</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://x.com/cg_martini" title="Martini Twitter" class="quarto-navigation-tool px-1" aria-label="Martini Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/Martini-Force-Field-Initiative" title="Martini GitHub" class="quarto-navigation-tool px-1" aria-label="Martini GitHub"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../docs/tutorials/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><b>Summary</b></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../docs/tutorials/Martini3/lectures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">🎓 Martini Lectures</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../docs/tutorials/Martini3/tutorials.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">🛠️ Hands-on Tutorials</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../docs/tutorials/Legacy/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">🕸️ Legacy Material</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#mdvcontainment-tutorial-1-martiniworkshop-2025" id="toc-mdvcontainment-tutorial-1-martiniworkshop-2025" class="nav-link active" data-scroll-target="#mdvcontainment-tutorial-1-martiniworkshop-2025">MDVContainment – Tutorial 1 (MartiniWorkshop 2025)</a>
  <ul class="collapse">
  <li><a href="#what-is-containment" id="toc-what-is-containment" class="nav-link" data-scroll-target="#what-is-containment">What is Containment</a>
  <ul class="collapse">
  <li><a href="#theory" id="toc-theory" class="nav-link" data-scroll-target="#theory">Theory</a></li>
  <li><a href="#goal-axioms" id="toc-goal-axioms" class="nav-link" data-scroll-target="#goal-axioms">Goal &amp; Axioms</a></li>
  <li><a href="#goal" id="toc-goal" class="nav-link" data-scroll-target="#goal">Goal</a></li>
  </ul></li>
  <li><a href="#content-of-this-tutorial" id="toc-content-of-this-tutorial" class="nav-link" data-scroll-target="#content-of-this-tutorial">Content of this Tutorial</a></li>
  </ul></li>
  <li><a href="#bicelle-vesicle-containment" id="toc-bicelle-vesicle-containment" class="nav-link" data-scroll-target="#bicelle-vesicle-containment">Bicelle Vesicle Containment</a>
  <ul class="collapse">
  <li><a href="#imports" id="toc-imports" class="nav-link" data-scroll-target="#imports">Imports</a></li>
  <li><a href="#loading-the-md-data" id="toc-loading-the-md-data" class="nav-link" data-scroll-target="#loading-the-md-data">Loading the MD Data</a></li>
  <li><a href="#general-design-of-mdvcontainment" id="toc-general-design-of-mdvcontainment" class="nav-link" data-scroll-target="#general-design-of-mdvcontainment">General design of MDVContainment</a></li>
  <li><a href="#running-the-containment-analysis" id="toc-running-the-containment-analysis" class="nav-link" data-scroll-target="#running-the-containment-analysis">Running the Containment Analysis</a>
  <ul class="collapse">
  <li><a href="#contact-graph" id="toc-contact-graph" class="nav-link" data-scroll-target="#contact-graph">Contact graph</a></li>
  <li><a href="#containment-graph" id="toc-containment-graph" class="nav-link" data-scroll-target="#containment-graph">Containment graph</a></li>
  <li><a href="#rank" id="toc-rank" class="nav-link" data-scroll-target="#rank">Rank</a></li>
  <li><a href="#grids" id="toc-grids" class="nav-link" data-scroll-target="#grids">Grids</a></li>
  </ul></li>
  <li><a href="#containment-graph-handling" id="toc-containment-graph-handling" class="nav-link" data-scroll-target="#containment-graph-handling">Containment Graph Handling</a>
  <ul class="collapse">
  <li><a href="#using-roots-and-leafs" id="toc-using-roots-and-leafs" class="nav-link" data-scroll-target="#using-roots-and-leafs">Using roots and leafs</a></li>
  <li><a href="#relative-component-acquisition" id="toc-relative-component-acquisition" class="nav-link" data-scroll-target="#relative-component-acquisition">Relative component acquisition</a></li>
  </ul></li>
  <li><a href="#volumetric-analysis" id="toc-volumetric-analysis" class="nav-link" data-scroll-target="#volumetric-analysis">Volumetric Analysis</a></li>
  <li><a href="#surface-analysis" id="toc-surface-analysis" class="nav-link" data-scroll-target="#surface-analysis">Surface Analysis</a>
  <ul class="collapse">
  <li><a href="#marching-cubes" id="toc-marching-cubes" class="nav-link" data-scroll-target="#marching-cubes">Marching cubes</a></li>
  <li><a href="#process-mesh-in-open3d" id="toc-process-mesh-in-open3d" class="nav-link" data-scroll-target="#process-mesh-in-open3d">Process mesh in open3d</a></li>
  <li><a href="#calculate-total-surface-area" id="toc-calculate-total-surface-area" class="nav-link" data-scroll-target="#calculate-total-surface-area">Calculate total surface area</a></li>
  <li><a href="#split-surface-area-between-inner-and-outer-surfaces" id="toc-split-surface-area-between-inner-and-outer-surfaces" class="nav-link" data-scroll-target="#split-surface-area-between-inner-and-outer-surfaces">Split surface area between inner and outer surfaces</a></li>
  </ul></li>
  <li><a href="#composition-analysis" id="toc-composition-analysis" class="nav-link" data-scroll-target="#composition-analysis">Composition Analysis</a>
  <ul class="collapse">
  <li><a href="#obtain-the-compositions" id="toc-obtain-the-compositions" class="nav-link" data-scroll-target="#obtain-the-compositions">Obtain the compositions</a></li>
  </ul></li>
  <li><a href="#containment-atomgroup-io" id="toc-containment-atomgroup-io" class="nav-link" data-scroll-target="#containment-atomgroup-io">Containment Atomgroup I/O</a>
  <ul class="collapse">
  <li><a href="#atomgroup-from-nodes" id="toc-atomgroup-from-nodes" class="nav-link" data-scroll-target="#atomgroup-from-nodes">Atomgroup from nodes</a></li>
  <li><a href="#voxels-positions-from-nodes" id="toc-voxels-positions-from-nodes" class="nav-link" data-scroll-target="#voxels-positions-from-nodes">Voxels positions from nodes</a></li>
  <li><a href="#atomgroup-from-voxel-positions" id="toc-atomgroup-from-voxel-positions" class="nav-link" data-scroll-target="#atomgroup-from-voxel-positions">Atomgroup from voxel positions</a></li>
  <li><a href="#writing-the-containment-atomgroup-with-annotated-components" id="toc-writing-the-containment-atomgroup-with-annotated-components" class="nav-link" data-scroll-target="#writing-the-containment-atomgroup-with-annotated-components">Writing the containment atomgroup with annotated components</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#assignments" id="toc-assignments" class="nav-link" data-scroll-target="#assignments">Assignments</a>
  <ul class="collapse">
  <li><a href="#assignment-1-define-a-lipid-vesicle" id="toc-assignment-1-define-a-lipid-vesicle" class="nav-link" data-scroll-target="#assignment-1-define-a-lipid-vesicle">Assignment 1: Define a Lipid Vesicle</a></li>
  <li><a href="#assignment-2-define-the-leaflets-of-a-lipid-vesicle" id="toc-assignment-2-define-the-leaflets-of-a-lipid-vesicle" class="nav-link" data-scroll-target="#assignment-2-define-the-leaflets-of-a-lipid-vesicle">Assignment 2: Define the Leaflets of a Lipid Vesicle</a></li>
  <li><a href="#assignment-3-be-creative-and-change-the-solvent" id="toc-assignment-3-be-creative-and-change-the-solvent" class="nav-link" data-scroll-target="#assignment-3-be-creative-and-change-the-solvent">Assignment 3: Be Creative and Change the Solvent</a></li>
  </ul></li>
  <li><a href="#flex-plotting-containment" id="toc-flex-plotting-containment" class="nav-link" data-scroll-target="#flex-plotting-containment">Flex Plotting Containment</a></li>
  <li><a href="#conclusion-1" id="toc-conclusion-1" class="nav-link" data-scroll-target="#conclusion-1">Conclusion</a>
  <ul class="collapse">
  <li><a href="#answers-to-the-questions" id="toc-answers-to-the-questions" class="nav-link" data-scroll-target="#answers-to-the-questions">Answers to the Questions</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header>




<section id="mdvcontainment-tutorial-1-martiniworkshop-2025" class="level1">
<h1>MDVContainment – Tutorial 1 (MartiniWorkshop 2025)</h1>
<p>This tutorial makes use of the <a href="https://cgmartini-library.s3.ca-central-1.amazonaws.com/0_Tutorials/m3_tutorials/MDVContainment/helper_tutorial_01.py">helper_tutorial_01.py</a> and the <a href="https://cgmartini-library.s3.ca-central-1.amazonaws.com/0_Tutorials/m3_tutorials/MDVContainment/bicelle.gro">bicelle.gro</a> structure, which can be downloaded by clicking on their respective link. Make sure to put these files in the same folder as you use to run this tutorial. To install MDVContainment, please take a look at the the project’s github page: <a href="https://github.com/BartBruininks/mdvcontainment">https://github.com/BartBruininks/mdvcontainment</a>.</p>
<section id="what-is-containment" class="level2">
<h2 class="anchored" data-anchor-id="what-is-containment">What is Containment</h2>
<p>Containment can be simply thought of as something <em>surrounding</em> something else completely (Fig. 0). This is useful for analyzing volumetric data in a hierarchical manner, allowing for robust processing at high throughput. This means containment it is a property which combines:</p>
<ol type="1">
<li><strong>Components</strong> How the total space is partitioned (Strongly Connected Components analysis, SCC).</li>
<li><strong>Contact Graph</strong> Components that share a boundary are connected with an edge.</li>
<li><strong>Containment Graph</strong> A component can be contained by another component, causing its edge designating the contact to point from the container to the content. I.e. the contained component lies downstream of the container component in the acyclic directed graph (DAG). Only the directed edges are present in the containment graph.</li>
</ol>
<p>Identifying inside and outside is non-trivial in periodic spaces and MDVContainment uses the concept of percolation to solve this problem. A component is considered contained if its inverse has a higher percolation number (rank) than the component itself, where the inverse of a component is all of space which is not the component in question. Meaning it also works for objects spanning the PBC such as a hollow periodic cylinder.</p>
<p>The binary nature of the component labeling (all labels are strongly connected) in combination with the containment status of individual components is enough to collapse the contact graph into the containment graph (adding direction and defining what is outside). The <a href="https://doi.org/10.1101/2025.08.06.668936">manuscript</a> of this work is available as a preprint.</p>
<center>
<img src="containment_examples.png" width="600">
</center>
<p><strong>Fig. 0</strong> Some examples of containment in periodic spaces. <strong>(A)</strong> A vesicle formed from a bicelle. <strong>(B)</strong> A periodic cylinder formed by dye molecules. <strong>(C)</strong> A lipoplex hovering above a membrane. <strong>D</strong> A horrific triple stacked bilayer system in which one of them has a pore. Try to wrap your head around that one with your intuition… In all the figures the red and blue densities represent lipid and solvent phases respectively. A density is rendered opaque if it does not have a child (it is a leaf in the containment graph), otherwise it is transparent (is a container). The arrows point from container to content. One can put every content into its container recursively to obtain the full box (albeit fragmented as is the case in system C).</p>
<section id="theory" class="level3">
<h3 class="anchored" data-anchor-id="theory">Theory</h3>
<p>We will start by clarifying the objective and what we mean by containment. To do so we will explicitly state the goal and eight axioms. The goal is the classifier we wish to obtain. The axioms are an extension of well-known mathematical concepts. Concepts such as <strong>connected components</strong> and <strong>percolation</strong> are taken for granted. Each axiom comes with a figure, to enforce what is intended.</p>
</section>
<section id="goal-axioms" class="level3">
<h3 class="anchored" data-anchor-id="goal-axioms">Goal &amp; Axioms</h3>
</section>
<section id="goal" class="level3">
<h3 class="anchored" data-anchor-id="goal">Goal</h3>
<p>To obtain a definition of containment resulting in a containment graph spanning the complete space. The containment graph is a directed acyclic (multi) graph. The components are the nodes in the graph and the directions of the edges indicate containment. The graph should satisfy the following conditions: First, a node cannot have more than one inward pointing edge. A, node can have more than one outward pointing edge. Second, the alteration of the containment hierarchy downstream should never affect the containment hierarchy upstream. All these conditions are satisfied by the axioms below and result in unambiguous specification of the containment hierarchy. An example of such a containment graph is given in Fig 1.</p>
<center>
<img src="example_containment_graph.png" width="600">
</center>
<p><strong>Fig. 1</strong> A 2D boolean density (left) and its corresponding containment graph (right) of four components in 2D periodic space (R2/Z2). A component contains all downstream components in the containment graph, plus itself. A single component (A) contains all the other components ({A, B, C, D}). There is one nested container (B) which also contains a component (C). The graph was drawn using https://graphonline.ru/en/.</p>
<section id="axiom-1.-space" class="level4">
<h4 class="anchored" data-anchor-id="axiom-1.-space">Axiom 1. space</h4>
<p>Space is regular and not curved (e.g.&nbsp;R, Z, R/Z, etc.; Fig. 2).</p>
<center>
<img src="A1.png" width="300">
</center>
<p><strong>Fig. 2</strong> Axiom 1. space. The space outlined with a square as a boundary. It needs not be a square nor does it has to have a boundary, this is just for illustrative purposes.</p>
</section>
<section id="axiom-2.-components" class="level4">
<h4 class="anchored" data-anchor-id="axiom-2.-components">Axiom 2. components</h4>
<p>The binary partitioning of space results in connected components which can be True or False. Whenever we use the word component we mean strongly connected component unless stated otherwise (Fig. 3).</p>
<center>
<img src="A2.png" width="450">
</center>
<p><strong>Fig. 3</strong> Axiom 2. components. The densities {A, D} are represented in peach. The void components {A, C} are white.</p>
</section>
<section id="axiom-3.-complements" class="level4">
<h4 class="anchored" data-anchor-id="axiom-3.-complements">Axiom 3. complements</h4>
<p>The complement of a component is all of space which is not the component, therefore a complement does not need to be connected. The complement of a component A is annotated as !A (Fig. 4).</p>
<center>
<img src="A3.png" width="850">
</center>
<p><strong>Fig. 4</strong> Axiom 3. complements. The complement !A is drawn in peach and its corresponding component A is drawn in white.</p>
</section>
<section id="axiom-4.-rank" class="level4">
<h4 class="anchored" data-anchor-id="axiom-4.-rank">Axiom 4. rank</h4>
<p>The rank (ρ) of a component, or its complement, is defined by the amount of orthogonal dimensions in which it percolates space [7]. The rank of a component or complement (A of rank 2) is indicated with a preceding subscript number (2A). Since a complement does not need to be connected, the rank of a compliment is the highest rank among the ranks of its components (Fig. 5).</p>
<center>
<img src="A4.png" width="600">
</center>
<p><strong>Fig. 5</strong> Axiom 4. rank. The rank of the void A with a dot (2), periodic line (1) and periodic net (0) are shown from left to right. The corresponding density B is of rank 0, 1 and 2 reciprocally.</p>
</section>
<section id="axiom-5.-component-containment" class="level4">
<h4 class="anchored" data-anchor-id="axiom-5.-component-containment">Axiom 5. component containment</h4>
<p>A component is contained if its complement is of higher rank. The containment status of a component (A) is annotated with a subscript c (Ac; Fig. 6).</p>
<center>
<img src="A5.png" width="550">
</center>
<p><strong>Fig. 6</strong> Axiom 5. component containment. The components {B, C, D} are contained, A is not. The densities {A, D} are represented in peach. The void components {A, C} are white).</p>
</section>
<section id="axiom-6.-component-contacts" class="level4">
<h4 class="anchored" data-anchor-id="axiom-6.-component-contacts">Axiom 6. component contacts</h4>
<p>Two components are in contact if they share a boundary. A contact between a component (A) and another component (B) is annotated with a tilde (A ∼ B). The collection of all contacts is called a contact graph (Fig. 7).</p>
<center>
<img src="A6.png" width="400">
</center>
<p><strong>Fig. 7</strong> Axiom 6. component contacts. Component A is in contact with components {B, D} and B is in contact with C. The densities {A, D} are represented in peach. The void components {A, C} are white. The boundaries are represented with black curves.</p>
</section>
<section id="axiom-7.-neighbor-containment" class="level4">
<h4 class="anchored" data-anchor-id="axiom-7.-neighbor-containment">Axiom 7. neighbor containment</h4>
<p>A component is contained by a neighboring component in the contact graph if it is contained and the neighbor is not. Containment of a component (A) by another component (B) is annotated with an arrow (B → A). The collection of all containment hierarchy in a space is called its containment graph (Fig. 8).</p>
<center>
<img src="A7.png" width="600">
</center>
<p><strong>Fig. 8</strong> Axiom 7. neighbor containment. Component A contains B and D. The densities {A, D} are represented in peach. The void components {A, C} are white.</p>
</section>
<section id="axiom-8.-recursive-neighbor-containment" class="level4">
<h4 class="anchored" data-anchor-id="axiom-8.-recursive-neighbor-containment">Axiom 8. recursive neighbor containment</h4>
<p>A component which is contained by a neighboring component contains all other components it is in contact with (Fig. 9).</p>
<center>
<img src="A8.png" width="750">
</center>
<p><strong>Fig. 9</strong> Axiom 8. recursive neighbor containment. Component C is contained by B due to recursion. The densities {A, D} are represented in peach. The void components {A, C} are white.</p>
<p>For questions or more information feel free to send an email to the author of this math and software (BMH Bruininks): <code>bartbruininks@gmail.com</code></p>
</section>
</section>
</section>
<section id="content-of-this-tutorial" class="level2">
<h2 class="anchored" data-anchor-id="content-of-this-tutorial">Content of this Tutorial</h2>
<p>To determine the containment hierarchy on the bicelle test system (Fig. 10) and then perform some basic analysis on it. This system contains a vesicle/bicelle made of oleic acids. The bicelle is solvated in water and inside the bicelle is a small which is also filled with water. Here you will get used to using mdv.Containment and run it directly on MDAnalysis atomgroups. We will perform a volume, genus and composition analysis of the components/containment.</p>
<ol type="1">
<li>Load a structure file and prepare for containment analysis</li>
<li>Running the containment analysis</li>
<li>Learn to work with the containment graph</li>
<li>Volumetric Analysis</li>
<li>Surface Analysis</li>
<li>Compositions Analysis</li>
<li>Assignments</li>
<li>Flex plotting</li>
<li>Conclusion</li>
<li>Answers to the question</li>
</ol>
</section>
</section>
<section id="bicelle-vesicle-containment" class="level1">
<h1>Bicelle Vesicle Containment</h1>
<section id="imports" class="level2">
<h2 class="anchored" data-anchor-id="imports">Imports</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Containment</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> mdvcontainment <span class="im">as</span> mdv</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> mdvcontainment.composition_logic <span class="im">as</span> cl</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mdvcontainment.containment_main <span class="im">import</span> VoxelContainment</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the helper functions for the tutorial</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> helper_tutorial_01 <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># MD programs</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> MDAnalysis <span class="im">as</span> mda</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> freud</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mdvwhole <span class="im">import</span> whole</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># General python</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> defaultdict</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> networkx <span class="im">as</span> nx</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper python</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> skimage <span class="im">import</span> measure</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> open3d <span class="im">as</span> o3d</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Turning off warnings for MDA as it tends to complain a lot with CG data</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Suppress all warnings from a specific package</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>, module<span class="op">=</span><span class="st">"MDAnalysis"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="loading-the-md-data" class="level2">
<h2 class="anchored" data-anchor-id="loading-the-md-data">Loading the MD Data</h2>
<p>MDVContainment is made so it works nicely with MDAnalysis for its structure file support (PDB, GRO, XTC, etc.). Start with creating an MDAnalysis universe from your structure file. We will make a copy of the wrapped and unwrapped structure (using <code>mdvwhole</code>) so we can use those for comparison if we want.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The path to the desired structure file</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>current_structure_path <span class="op">=</span> <span class="st">'bicelle.gro'</span> <span class="co"># Change me to point to a structure!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This GRO file is already made whole but lets wrap it up</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>u <span class="op">=</span> mda.Universe(current_structure_path)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>u.atoms.wrap() <span class="co"># Wrap everything in the PBC box so no points lie outside the dimensions</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>u.atoms.write(<span class="st">'wrapped.pdb'</span>) <span class="co"># Write the atomgroup after its wrapped in the box</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>wrapped_positions <span class="op">=</span> np.copy(u.atoms.positions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's make the structure whole so we can play a bit and see if it matters</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>atomgroup_selection <span class="op">=</span> u.select_atoms(<span class="st">'not resname W WF ION'</span>) <span class="co"># The selection to make whole</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>resolution <span class="op">=</span> <span class="fl">0.5</span> <span class="co"># Sets the voxel size for the resolution</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>closing <span class="op">=</span> <span class="va">True</span> <span class="co"># Uses binary dilaten and then erosion to close small gaps</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>whole_universe <span class="op">=</span> whole.Whole(atomgroup_selection, <span class="fl">0.5</span>, closing,).voxels.atomgroup.universe</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the wrapping and unwrapping worked out</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Wrapped positions and unwrapped positions are idential (False is good): </span><span class="op">\</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="sc">{</span>np<span class="sc">.</span><span class="bu">all</span>(whole_universe.atoms.positions <span class="op">==</span> wrapped_positions)<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>Wrapped positions and unwrapped positions are idential (False is good): False</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Write the atomgroup after it has been made whole</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>whole_universe.atoms.write(<span class="st">'whole.pdb'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<center>
<img src="bicelle.png" width="600">
</center>
<p><strong>Fig. 10</strong> A VMD render of the system. The bicelle is made whole over PBC using MDVWhole. It might be useful to keep in mind that, broken or not, it does not matter for MDVContainment.</p>
</section>
<section id="general-design-of-mdvcontainment" class="level2">
<h2 class="anchored" data-anchor-id="general-design-of-mdvcontainment">General design of MDVContainment</h2>
<p>The output of the containment analysis is more or less an MDAnalysis wrapper around <code>mdvcontainment.containment_main.VoxelContainment</code>. It handles all bookkeeping for moving from an atomgroup to (segmented) voxels and back. When you run <code>mdvcontainment.Containment()</code>, it converts the input atomgroup into a boolean grid and performs the analysis on the grid. Then the analysis can be projected back into atomgroup(s).</p>
<div class="alert alert-block alert-info">
<p><b>Tip:</b> Do not forget python allows you to use help() and dir() on objects to explore them.</p>
</div>
<p>To work with the voxel containment data, we can use the <code>.voxel_containment</code> attribute of the containment output. This will be demonstrated below in some examples.</p>
</section>
<section id="running-the-containment-analysis" class="level2">
<h2 class="anchored" data-anchor-id="running-the-containment-analysis">Running the Containment Analysis</h2>
<p>Running a containment analysis requires very little from the user, it requires an atomgroup, a resolution for the voxel size (nm), and weather or not you want to close single voxel holes using binary closing. The resolution should never be smaller than the first neighbor distance of the condensed phase you are studying. For Martini CG systems this is about 0.5 nm, with closing to fill small holes. For atomistic data a smaller resolution could be used, although usually a resolution of 0.5 with or without closing works pretty good. In general a smaller value for the resolution results in an increase in computational load, both for memory and compute.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Selecting all tail beads (see what happens if you exclude the first tail bead as well!)</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">#selection_atomgroup = u.select_atoms('name [CD][12345][AB]') </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A slightly more conservative selection for the lipid densities</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>selection_atomgroup <span class="op">=</span> u.select_atoms(<span class="st">'name [CD][2345][AB]'</span>) </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>resolution <span class="op">=</span> <span class="fl">0.5</span> <span class="co"># The voxel size in nanometers</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>closing <span class="op">=</span> <span class="va">True</span> <span class="co"># Uses binary dilation and erosion to close tiny holes</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>containment <span class="op">=</span> mdv.Containment(selection_atomgroup, resolution, closing)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(containment) <span class="co"># Shows the containment hierarchy</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>WARNING: beta/tempfactors already set in the universe, and will be overwritten with the component ids.
Containment Graph with 3 components (component: nvoxels):
└── [-2: 59600]
    └── [1: 3868]
        └── [-1: 532]</code></pre>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question 1
</div>
</div>
<div class="callout-body-container callout-body">
<p>Which component(s) are the ones occupied with your selection?</p>
</div>
</div>
<section id="contact-graph" class="level3">
<h3 class="anchored" data-anchor-id="contact-graph">Contact graph</h3>
<p>The contact graph annotates every components contacts where a component is considered in contact if they share on of their 26 voxel neighbors (they share a vertex of their voxel simplices). The contact graph is always strongly connected.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The contacts graph</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>contact_graph <span class="op">=</span> containment.voxel_containment.component_contact_graph</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>nx.draw_networkx(contact_graph)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="output_21_0.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the contact graph is indeed strongly connected </span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'The amount of connected components in the contact graph: </span><span class="sc">{</span><span class="bu">len</span>(<span class="bu">list</span>(nx.connected_components(contact_graph)))<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>The amount of connected components in the contact graph: 1</code></pre>
</section>
<section id="containment-graph" class="level3">
<h3 class="anchored" data-anchor-id="containment-graph">Containment graph</h3>
<p>The containment graph annotates containment with a directed edge pointing from the container to the content. Their might be multiple outsides in a system (like in the case of a periodic bilayer), meaning the containment graph might be disconnected. This is due to the fact that the directed edges in the containment graph are a subset of the undirected edges in the contact graph.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Draw the containment graph</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>containment_graph <span class="op">=</span> containment.voxel_containment.containment_graph</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>nx.draw_networkx(containment_graph)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="output_24_0.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question 2
</div>
</div>
<div class="callout-body-container callout-body">
<p>Which component is contained by component 1?</p>
</div>
</div>
<div class="sourceCode" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the containment graph is strongly connected</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'The amount of connected components in the containment graph: </span><span class="sc">{</span><span class="bu">len</span>(<span class="bu">list</span>(nx.connected_components(contact_graph)))<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>The amount of connected components in the containment graph: 1</code></pre>
<p>The containment graph is also strongly connected, meaning the whole box can be described as a single recursive containment branch (there is only one absolute outside).</p>
</section>
<section id="rank" class="level3">
<h3 class="anchored" data-anchor-id="rank">Rank</h3>
<p>The rank of a component is the amount of orthogonal dimensions in which is spans the PBC. In other words, how intrinsically periodic is a component.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The rank (percolation number) per component</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>ranks <span class="op">=</span> containment.voxel_containment.component_ranks</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> [<span class="bu">print</span>(<span class="ss">f'The rank for component </span><span class="sc">{</span><span class="bu">int</span>(key)<span class="sc">}</span><span class="ss"> is: </span><span class="sc">{</span><span class="bu">int</span>(value)<span class="sc">}</span><span class="ss">'</span>) <span class="cf">for</span> key, value <span class="kw">in</span> ranks.items()]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>The rank for component 1 is: 0
The rank for component -1 is: 0
The rank for component -2 is: 3</code></pre>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question 3
</div>
</div>
<div class="callout-body-container callout-body">
<p>What densities would have rank 1?</p>
</div>
</div>
</section>
<section id="grids" class="level3">
<h3 class="anchored" data-anchor-id="grids">Grids</h3>
<p>The boolean grid used for the segmentation and the integer labeling grid are both exposed in <code>containment.voxel_containment</code></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The selection grid</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>boolean_grid <span class="op">=</span> containment.voxel_containment.grid</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'The boolean grid has the following dimensions: </span><span class="sc">{</span>boolean_grid<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'The boolean grid contains the following unique values: </span><span class="sc">{</span>np<span class="sc">.</span>unique(boolean_grid)<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>The boolean grid has the following dimensions: (40, 40, 40)
The boolean grid contains the following unique values: [False  True]</code></pre>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question 4
</div>
</div>
<div class="callout-body-container callout-body">
<p>How many voxels are there in total?</p>
</div>
</div>
<div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The 26 neighbors connected component labeling grid, </span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co">#  True grid values have positive labels and False grid values have </span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  negative labels (taking PBC into account).</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>labeled_grid <span class="op">=</span> containment.voxel_containment.components_grid</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'The labeling grid has the same dimensions as the boolean grid: </span><span class="sc">{</span>boolean_grid<span class="sc">.</span>shape <span class="op">==</span> labeled_grid<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'The labeled grid contains the following unique values: </span><span class="sc">{</span>np<span class="sc">.</span>unique(labeled_grid)<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>The labeling grid has the same dimensions as the boolean grid: True
The labeled grid contains the following unique values: [-2 -1  1]</code></pre>
<div class="alert alert-block alert-info">
<p><b>Tip:</b> You can take a look at the help and dir <code>help(containment)</code> and/or <code>dir(containment.voxel_containment)</code> to have a look at your options to work with the containment object (at the voxel level).</p>
</div>
<section id="conclusion" class="level4">
<h4 class="anchored" data-anchor-id="conclusion">Conclusion</h4>
<ul>
<li>There is a large component {-2} which is the outside. It is negative so it is not made out of atoms in our selection. Our selection contained all lipid tails so this means the outside is made out everything else (water, ions and linkers). It has a percolation number of 3 meaning it is periodic in all the dimensions of space.</li>
<li>Inside this water compartment lies our only positive component {1}, meaning it is made out of atoms in our selection. Thus, we have a drifting lipid density in water.</li>
<li>Finally, inside this lipid density lies one tiny compartment {-1}, as indicated by their voxel counts. As they are negative this must be another volume of non-lipid tails. However, if we select also the first lipid tail bead, we get two small compartments inside the lipid vesicle.</li>
</ul>
<p>Without having to open the structure with a 3D viewer, we are pretty well informed about what is currently present in our simulation. This allows for high throughput processing of complex systems and morphologies!</p>
</section>
</section>
</section>
<section id="containment-graph-handling" class="level2">
<h2 class="anchored" data-anchor-id="containment-graph-handling">Containment Graph Handling</h2>
<p>Being able to define components not on their local identity, but their global graph identity can be a big deal for handling high throughput data. This can be done by using the containment graph, as it contains information of how a single component (or multiple) is nested in the global environment.</p>
<section id="using-roots-and-leafs" class="level3">
<h3 class="anchored" data-anchor-id="using-roots-and-leafs">Using roots and leafs</h3>
<p>This can for example be used to auto analyze the content of a container if present using the concept of roots and leafs. A root is a node in a directed acyclic graph (DAG) which has no parent, and leaf is a node which has no children. We can recognize all components which contained by the fact that they have at least one parent. Thus all non-root nodes in the containment graph are contained.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question 5
</div>
</div>
<div class="callout-body-container callout-body">
<p>Can a root node be a leaf node?</p>
</div>
</div>
<div class="sourceCode" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We convert the data types to a simple int for nicer printing</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>all_nodes <span class="op">=</span> <span class="bu">set</span>(<span class="bu">int</span>(i) <span class="cf">for</span> i <span class="kw">in</span> containment.voxel_containment.nodes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># All nodes with no parents</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>root_nodes <span class="op">=</span> <span class="bu">set</span>(<span class="bu">int</span>(i) <span class="cf">for</span> i <span class="kw">in</span> containment.voxel_containment.root_nodes) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># All nodes with no children</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>leaf_nodes <span class="op">=</span> <span class="bu">set</span>(<span class="bu">int</span>(i) <span class="cf">for</span> i <span class="kw">in</span> containment.voxel_containment.leaf_nodes) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform some selection to filter contained and uncontained nodes</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>contained_nodes <span class="op">=</span> all_nodes <span class="op">-</span> root_nodes</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>not_contained_nodes <span class="op">=</span> all_nodes <span class="op">-</span> contained_nodes</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'The following nodes are not contained: </span><span class="sc">{</span>not_contained_nodes<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'The following nodes are contained: </span><span class="sc">{</span>contained_nodes<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>The following nodes are not contained: {-2}
The following nodes are contained: {1, -1}</code></pre>
</section>
<section id="relative-component-acquisition" class="level3">
<h3 class="anchored" data-anchor-id="relative-component-acquisition">Relative component acquisition</h3>
<p>Using a list of component ids for relative component querying, traveling up and down the DAG of containment.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the children of nodes (we turned it into a set so we convert it to list)</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>child_nodes <span class="op">=</span> <span class="bu">set</span>(<span class="bu">int</span>(i) <span class="cf">for</span> i <span class="kw">in</span> containment.voxel_containment.get_child_nodes(<span class="bu">list</span>(root_nodes))) </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'The root nodes: </span><span class="sc">{</span>root_nodes<span class="sc">}</span><span class="ss"> have the following child nodes: </span><span class="sc">{</span>child_nodes<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>The root nodes: {-2} have the following child nodes: {1}</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the parents of nodes</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>parent_nodes <span class="op">=</span> <span class="bu">set</span>(<span class="bu">int</span>(i) <span class="cf">for</span> i <span class="kw">in</span> containment.voxel_containment.get_parent_nodes(<span class="bu">list</span>(leaf_nodes))) <span class="co"># Again we should use a list here</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'The leaf nodes: </span><span class="sc">{</span>leaf_nodes<span class="sc">}</span><span class="ss"> have the following parent nodes: </span><span class="sc">{</span>parent_nodes<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>The leaf nodes: {-1} have the following parent nodes: {1}</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get all downstream nodes (includes self)</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>downstream_nodes <span class="op">=</span> <span class="bu">set</span>(<span class="bu">int</span>(i) <span class="cf">for</span> i <span class="kw">in</span> containment.voxel_containment.get_downstream_nodes(<span class="bu">list</span>(root_nodes)))</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'The root nodes: </span><span class="sc">{</span>root_nodes<span class="sc">}</span><span class="ss"> have the following downstream nodes: </span><span class="sc">{</span>downstream_nodes<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>The root nodes: {-2} have the following downstream nodes: {1, -2, -1}</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get all upstream nodes (includes self)</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>upstream_nodes <span class="op">=</span> <span class="bu">set</span>(<span class="bu">int</span>(i) <span class="cf">for</span> i <span class="kw">in</span> containment.voxel_containment.get_upstream_nodes(<span class="bu">list</span>(leaf_nodes)))</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'The leaf nodes: </span><span class="sc">{</span>leaf_nodes<span class="sc">}</span><span class="ss"> have the following upstream nodes: </span><span class="sc">{</span>upstream_nodes<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>The leaf nodes: {-1} have the following upstream nodes: {1, -2, -1}</code></pre>
</section>
</section>
<section id="volumetric-analysis" class="level2">
<h2 class="anchored" data-anchor-id="volumetric-analysis">Volumetric Analysis</h2>
<p>The volume of the components is indicated by the voxel count per component in the containment graph and is stored in <code>.voxel_containment.voxel_counts</code>.</p>
<p>If we want to be precise about the exact volume we should not naively assume that our target voxel volume (resolution^3) is perfectly matching the resulting voxel volume. This is due to the fact that MDVContainment has to pick the resolution such that it perfectly tiles the unit cell. Therefore MDVContainment needs to adjust the requested resolution slightly to satisfy this constraint. Thus to obtain the exact volumes we need to query the voxel counts in each component and multiply it by our exact single voxel volume.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Determining the single voxel volume</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>nvoxels <span class="op">=</span> np.prod(containment.voxel_containment.grid.shape)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>box_volume <span class="op">=</span> mda.lib.mdamath.box_volume(u.dimensions) <span class="op">/</span> <span class="dv">1000</span>  <span class="co"># We need to correct that MDA is A^3 instead of nm^3.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>voxel_volume <span class="op">=</span> box_volume <span class="op">/</span> nvoxels</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'A single voxel has a volume of </span><span class="sc">{</span>voxel_volume<span class="sc">:.3f}</span><span class="ss"> nm^3, which is </span><span class="sc">{</span><span class="bu">abs</span>(resolution<span class="op">**</span><span class="dv">3</span> <span class="op">-</span> voxel_volume)<span class="sc">:.3f}</span><span class="op">\</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="ss">nm^3 off from the target resolution (</span><span class="sc">{</span>resolution<span class="sc">}</span><span class="ss"> nm) with a volume of </span><span class="sc">{</span>resolution<span class="op">**</span><span class="dv">3</span><span class="sc">}</span><span class="ss"> nm^3.'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>A single voxel has a volume of 0.123 nm^3, which is 0.002nm^3 off from the target resolution (0.5 nm) with a volume of 0.125 nm^3.</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># All the nodes in the containment graph</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>component_ids <span class="op">=</span> [<span class="bu">int</span>(<span class="bu">id</span>) <span class="cf">for</span> <span class="bu">id</span> <span class="kw">in</span> containment.voxel_containment.nodes] </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(component_ids)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>[-2, -1, 1]</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtaining the formatted counts</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>voxel_counts <span class="op">=</span> {<span class="bu">int</span>(<span class="bu">id</span>):<span class="bu">float</span>(count) <span class="cf">for</span> <span class="bu">id</span>, count <span class="kw">in</span> containment.voxel_containment.voxel_counts.items()}</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(voxel_counts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>{-2: 59600.0, -1: 532.0, 1: 3868.0}</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Moving from counting voxels to quantitative volume determination</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>volumes <span class="op">=</span> {<span class="bu">int</span>(<span class="bu">id</span>):<span class="bu">float</span>(count<span class="op">*</span>voxel_volume) <span class="cf">for</span> <span class="bu">id</span>, count <span class="kw">in</span> voxel_counts.items()} <span class="co"># Some additional formatting for nice printing</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(volumes) <span class="co"># The component volumes in nm^3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>{-2: 7350.741135707312, -1: 65.61399805698474, 1: 477.05816632409204}</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Determining the total volume of the bicelle vesicle and its content combined</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>active_components <span class="op">=</span> containment.voxel_containment.get_downstream_nodes([<span class="dv">1</span>]) <span class="co"># Includes the lipid density as well!</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>combined_volume <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> component <span class="kw">in</span> active_components:</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    combined_volume <span class="op">+=</span> volumes[component]</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'The volume of the lipid component and its content is: </span><span class="sc">{</span>combined_volume<span class="sc">:.02f}</span><span class="ss"> nm^3'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>The volume of the lipid component and its content is: 542.67 nm^3</code></pre>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question 6
</div>
</div>
<div class="callout-body-container callout-body">
<p>What advantage does it bring to make the voxels perfectly tile the box?</p>
</div>
</div>
</section>
<section id="surface-analysis" class="level2">
<h2 class="anchored" data-anchor-id="surface-analysis">Surface Analysis</h2>
<p>Although containment is a volumetric analysis, nothing is stopping us from converting our volume to a (set of) surfaces. The advantage is that certain observables like surface area are not converging nicely for voxels as the voxel volume decreases – like volume does. Another thing to keep in mind is that a volume has no genus, but a surface does, therefore for certain topological analysis it might be important to work with explicit surfaces instead!</p>
<section id="marching-cubes" class="level3">
<h3 class="anchored" data-anchor-id="marching-cubes">Marching cubes</h3>
<p>We can use the marching cubes algorithm to transform our density into (a) surfaces.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use marching cubes to obtain the contour surfaces</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>active_components <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>combined_grid <span class="op">=</span> containment.voxel_containment.get_voxel_mask([active_components])</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>vertices, faces, normals, values <span class="op">=</span> measure.marching_cubes(combined_grid.astype(<span class="bu">float</span>), level<span class="op">=</span><span class="fl">0.5</span>, spacing<span class="op">=</span>(<span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question 7
</div>
</div>
<div class="callout-body-container callout-body">
<p>Check how PBC is taken into account for the mesh generation!</p>
</div>
</div>
</section>
<section id="process-mesh-in-open3d" class="level3">
<h3 class="anchored" data-anchor-id="process-mesh-in-open3d">Process mesh in open3d</h3>
<div class="sourceCode" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_mesh_from_arrays(vertices, faces, visualize<span class="op">=</span><span class="va">False</span>, write<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns an open3d mesh object and writes the mesh to the given path for a ply file (example.ply) if write specifies a path.</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create the mesh and set vertices and triangles during initialization</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    mesh <span class="op">=</span> o3d.geometry.TriangleMesh(</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>        vertices<span class="op">=</span>o3d.utility.Vector3dVector(vertices),</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>        triangles<span class="op">=</span>o3d.utility.Vector3iVector(faces)</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>    mesh.triangles <span class="op">=</span> o3d.utility.Vector3iVector(np.flip(np.asarray(mesh.triangles), axis<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Optional: compute normals for better visualization</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>    mesh.compute_vertex_normals()</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> visualize:</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Visualize (uncomment the line below)</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>        o3d.visualization.draw_geometries([mesh])</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> write:</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Save</span></span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>        o3d.io.write_triangle_mesh(<span class="st">'bicelle_with_content.ply'</span>, mesh)</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mesh</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the obtained vertices and triangles to create a open3d mesh object</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>mesh <span class="op">=</span> create_mesh_from_arrays(vertices, faces, visualize<span class="op">=</span><span class="va">False</span>, write<span class="op">=</span><span class="va">False</span>) <span class="co"># Set visualize to True to see the mesh!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="calculate-total-surface-area" class="level3">
<h3 class="anchored" data-anchor-id="calculate-total-surface-area">Calculate total surface area</h3>
<div class="sourceCode" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combined area can be easily obtained using the .get_surface_area() method of the mesh</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>total_area <span class="op">=</span> mesh.get_surface_area() <span class="op">/</span> <span class="dv">100</span> <span class="co"># We need to convert from A^2 to nm^2</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'The total area of the combined mesh(es) is: </span><span class="sc">{</span>total_area<span class="sc">:.02f}</span><span class="ss"> nm^2'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>The total area of the combined mesh(es) is: 22.29 nm^2</code></pre>
</section>
<section id="split-surface-area-between-inner-and-outer-surfaces" class="level3">
<h3 class="anchored" data-anchor-id="split-surface-area-between-inner-and-outer-surfaces">Split surface area between inner and outer surfaces</h3>
<p>For simplicity we simply split inner and outer, even though there might be multiple inner surfaces.</p>
<section id="individual-areas-outer-first" class="level4">
<h4 class="anchored" data-anchor-id="individual-areas-outer-first">Individual areas (outer first)</h4>
<div class="sourceCode" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Containment for the bicelle with all its content</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>inner_outer_area <span class="op">=</span> {}</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>bicelle_component <span class="op">=</span> <span class="dv">1</span> <span class="co"># hard coded, but could we do something more clever?</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>bicelle_container_components <span class="op">=</span> containment.voxel_containment.get_downstream_nodes([bicelle_component])</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>bicelle_container_grid <span class="op">=</span> containment.voxel_containment.get_voxel_mask(bicelle_container_components)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use marching cubes to obtain the contour surfaces</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>vertices, faces, normals, values <span class="op">=</span> measure.marching_cubes(bicelle_container_grid.astype(<span class="bu">float</span>), level<span class="op">=</span><span class="fl">0.5</span>, spacing<span class="op">=</span>(<span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the mesh and set vertices and triangles during initialization</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>mesh <span class="op">=</span> create_mesh_from_arrays(vertices, faces, visualize<span class="op">=</span><span class="va">False</span>, write<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the area for the outer mesh</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>inner_outer_area[<span class="st">'outer'</span>] <span class="op">=</span> mesh.get_surface_area() <span class="op">/</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="now-lets-work-on-the-inner-part" class="level4">
<h4 class="anchored" data-anchor-id="now-lets-work-on-the-inner-part">Now lets work on the inner part</h4>
<div class="sourceCode" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># start with subtracting self from the bicelle container</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>bicelle_container_components <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(containment.voxel_containment.get_downstream_nodes([bicelle_component])) <span class="op">-</span> <span class="bu">set</span>([bicelle_component]))</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>bicelle_container_grid <span class="op">=</span> containment.voxel_containment.get_voxel_mask(bicelle_container_components)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use marching cubes to obtain the contour surfaces</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>vertices, faces, normals, values <span class="op">=</span> measure.marching_cubes(bicelle_container_grid.astype(<span class="bu">float</span>), level<span class="op">=</span><span class="fl">0.5</span>, spacing<span class="op">=</span>(<span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the mesh and set vertices and triangles during initialization</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>mesh <span class="op">=</span> create_mesh_from_arrays(vertices, faces, visualize<span class="op">=</span><span class="va">False</span>, write<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate area for the inner meshes</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>inner_outer_area[<span class="st">'inner'</span>] <span class="op">=</span> mesh.get_surface_area() <span class="op">/</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="final-results" class="level4">
<h4 class="anchored" data-anchor-id="final-results">Final results</h4>
<div class="sourceCode" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the results of calculating the areas and compare to previous result</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'The inner and outer surface areas are respectively: </span><span class="sc">{</span>inner_outer_area[<span class="st">'inner'</span>]<span class="sc">:.02f}</span><span class="ss"> and </span><span class="sc">{</span>inner_outer_area[<span class="st">'outer'</span>]<span class="sc">:.02f}</span><span class="ss"> nm^2'</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Take floating point accuracy into account!</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'The sum of innner and outer area is equal to the combined area calculated previously: </span><span class="op">\</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="sc">{</span><span class="bu">abs</span>(total_area <span class="op">-</span> np.<span class="bu">sum</span>(<span class="bu">list</span>(inner_outer_area.values()))) <span class="op">&lt;</span> <span class="fl">0.000001</span><span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>The inner and outer surface areas are respectively: 4.74 and 17.55 nm^2
The sum of innner and outer area is equal to the combined area calculated previously: True</code></pre>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question 8
</div>
</div>
<div class="callout-body-container callout-body">
<p>What’s the advantage in using this splitting of the meshes over just running a connected component analysis on the total mesh?</p>
</div>
</div>
</section>
</section>
</section>
<section id="composition-analysis" class="level2">
<h2 class="anchored" data-anchor-id="composition-analysis">Composition Analysis</h2>
<p>To obtain the composition, a few composition analysis helper functions have been added to MDVContainment. However, to nicely visualize the result some additional matplotlib plotting functions were made specifically for this tutorial. In general this plotting should work reasonably well, but it is near impossible to create a single way of visualizing the compositions which works for all systems. In the end making good data visualization is an art!</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the target nodes to investigate to all nodes in the containment</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>component_ids <span class="op">=</span> containment.voxel_containment.nodes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the containment one more time so we do not forget the structure of our data</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(containment)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>Containment Graph with 3 components (component: nvoxels):
└── [-2: 59600]
    └── [1: 3868]
        └── [-1: 532]</code></pre>
<div class="alert alert-block alert-info">
<p><b>Tip:</b> The atom name/resname/molar count of each atom in the compartments can be counted and stored easily in a <code>compositions_dict</code> using the helper functions in the <code>mdvcontainment.compositions_logic</code>.</p>
</div>
<section id="obtain-the-compositions" class="level3">
<h3 class="anchored" data-anchor-id="obtain-the-compositions">Obtain the compositions</h3>
<section id="make-the-pie-chart-plots-counting-the-names-of-the-atoms" class="level4">
<h4 class="anchored" data-anchor-id="make-the-pie-chart-plots-counting-the-names-of-the-atoms">Make the pie chart plots counting the names of the atoms</h4>
<div class="sourceCode" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>mode <span class="op">=</span> <span class="st">'names'</span> <span class="co"># 'resnames, names or molar'</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>compositions_names <span class="op">=</span> cl.get_compositions(containment, component_ids, mode)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>compositions, fig, axs <span class="op">=</span> analyse_composition(u, containment, compositions_names, mode, min_label_percent<span class="op">=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="output_84_0.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
</section>
<section id="make-the-pie-chart-plots-counting-the-resnames-of-the-atoms" class="level4">
<h4 class="anchored" data-anchor-id="make-the-pie-chart-plots-counting-the-resnames-of-the-atoms">Make the pie chart plots counting the resnames of the atoms</h4>
<div class="sourceCode" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>mode <span class="op">=</span> <span class="st">'resnames'</span> <span class="co"># 'resnames, names or molar'</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>compositions_resnames <span class="op">=</span> cl.get_compositions(containment, component_ids, mode)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>compositions, fig, axs <span class="op">=</span> analyse_composition(u, containment, compositions_resnames, mode, min_label_percent<span class="op">=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="output_86_0.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
</section>
<section id="make-the-pie-chart-plots-counting-the-resnames-of-the-involved-molecules-only-count-each-molecule-once" class="level4">
<h4 class="anchored" data-anchor-id="make-the-pie-chart-plots-counting-the-resnames-of-the-involved-molecules-only-count-each-molecule-once">Make the pie chart plots counting the resnames of the involved molecules (only count each molecule once)</h4>
<div class="sourceCode" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>mode <span class="op">=</span> <span class="st">'molar'</span> <span class="co"># 'resnames, names or molar'</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>compositions_molar <span class="op">=</span> cl.get_compositions(containment, component_ids, mode)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>compositions, fig, axs <span class="op">=</span> analyse_composition(u, containment, compositions_molar, mode, min_label_percent<span class="op">=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="output_88_0.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
</section>
</section>
</section>
<section id="containment-atomgroup-io" class="level2">
<h2 class="anchored" data-anchor-id="containment-atomgroup-io">Containment Atomgroup I/O</h2>
<p>If you are used to working with MDAnalysis universes and atomgroups, it can be very useful to convert your voxel components back into atomgroups. MDVContainment comes with some nice MDAnalysis interfacing capabilities to shield you from most of the bookkeeping.</p>
<section id="atomgroup-from-nodes" class="level3">
<h3 class="anchored" data-anchor-id="atomgroup-from-nodes">Atomgroup from nodes</h3>
<p>This is probably the most useful method to know. It can turn a selection of component_ids in the containment graph into an MDAnalysis atomgroup.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># The atomgroup containing the inside of the bicelle</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>atomgroup_from_nodes <span class="op">=</span> containment.get_atomgroup_from_nodes(<span class="bu">list</span>(leaf_nodes))</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(atomgroup_from_nodes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>&lt;AtomGroup [&lt;Atom 11: COO of type C of resname OA-1, resid 3 and segid SYSTEM&gt;, &lt;Atom 12: C1A of type C of resname OA-1, resid 3 and segid SYSTEM&gt;, &lt;Atom 21: COO of type C of resname OA-1, resid 5 and segid SYSTEM&gt;, ..., &lt;Atom 66210: C1A of type C of resname OAOH, resid 61465 and segid SYSTEM&gt;, &lt;Atom 66259: COOH of type C of resname OAOH, resid 61475 and segid SYSTEM&gt;, &lt;Atom 66260: C1A of type C of resname OAOH, resid 61475 and segid SYSTEM&gt;]&gt;</code></pre>
</section>
<section id="voxels-positions-from-nodes" class="level3">
<h3 class="anchored" data-anchor-id="voxels-positions-from-nodes">Voxels positions from nodes</h3>
<p>For more advanced analysis using voxel operations, one could prefer to work on the voxel grid itself.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># All the positions in the contaiment.voxel_containment.components_grid for the outer solvent phase</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>voxel_positions_from_atomgroup <span class="op">=</span> containment.voxel_containment.get_voxel_positions(<span class="bu">list</span>(root_nodes)) </span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(voxel_positions_from_atomgroup)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>[[ 0  0  0]
 [ 0  0  1]
 [ 0  0  2]
 ...
 [39 39 37]
 [39 39 38]
 [39 39 39]]</code></pre>
</section>
<section id="atomgroup-from-voxel-positions" class="level3">
<h3 class="anchored" data-anchor-id="atomgroup-from-voxel-positions">Atomgroup from voxel positions</h3>
<p>Why stick to converting components into atomgroups, any voxel selection can be converted into an atomgroup!</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify custom voxels to convert to an atomgroup</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>atomgroup_from_voxels <span class="op">=</span> containment.get_atomgroup_from_voxel_positions(voxel_positions_from_atomgroup)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(atomgroup_from_voxels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>&lt;AtomGroup [&lt;Atom 1: COO of type C of resname OA-1, resid 1 and segid SYSTEM&gt;, &lt;Atom 2: C1A of type C of resname OA-1, resid 1 and segid SYSTEM&gt;, &lt;Atom 6: COO of type C of resname OA-1, resid 2 and segid SYSTEM&gt;, ..., &lt;Atom 66254: COOH of type C of resname OAOH, resid 61474 and segid SYSTEM&gt;, &lt;Atom 66264: COOH of type C of resname OAOH, resid 61476 and segid SYSTEM&gt;, &lt;Atom 66265: C1A of type C of resname OAOH, resid 61476 and segid SYSTEM&gt;]&gt;</code></pre>
</section>
<section id="writing-the-containment-atomgroup-with-annotated-components" class="level3">
<h3 class="anchored" data-anchor-id="writing-the-containment-atomgroup-with-annotated-components">Writing the containment atomgroup with annotated components</h3>
<p>We can ignore all the MDAnalysis warnings with respect to missing information as we simply want to write the atoms/residues/positions and labeling. The labeling of the components is written to the beta factor. This means the labeled components are not present if one writes a GRO file, as GRO files don’t have a beta factor field.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>u.atoms.write(<span class="st">'containment.pdb'</span>) <span class="co"># beta fields are changed in place as indicated!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Uncomment these following lines and update the path, if you have VMD installed and want to look at the labeled structure file.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Change me to point to the result of "which vmd" in your terminal</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="co">#vmd_path = '/Applications/VMD\ 1.9.4a57-arm64-Rev12.app/Contents/MacOS/startup.command.csh' </span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="co"># VMD usage E.g. in atomselect 'beta "-3"' would show the outside water volume, do not forget the quotes around negative numbers!</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="co">#!$vmd_path containment.pdb </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
</section>
<section id="assignments" class="level1">
<h1>Assignments</h1>
<section id="assignment-1-define-a-lipid-vesicle" class="level2">
<h2 class="anchored" data-anchor-id="assignment-1-define-a-lipid-vesicle">Assignment 1: Define a Lipid Vesicle</h2>
<p>Using component acquisition and composition analysis, define what it means to be a vesicle and only return what the vesicle coat is made of and what it contains.</p>
<p>Keep the following complications in mind: * What would happen if there are no components satisfying your constraints? * What if there are multiple vesicles? * What about nested vesicles? * Check out tutorial 2 to see if you definition holds up :D</p>
</section>
<section id="assignment-2-define-the-leaflets-of-a-lipid-vesicle" class="level2">
<h2 class="anchored" data-anchor-id="assignment-2-define-the-leaflets-of-a-lipid-vesicle">Assignment 2: Define the Leaflets of a Lipid Vesicle</h2>
<p>Use your definition of the lipid vesicle to find the compositions of its leaflets.</p>
<p>Keep the following in mind:</p>
<ul>
<li>Remember one can obtain the atomgroups and use them with MDAnalysis distance queries.</li>
<li>Think about which components need to distance query each other to cause their overlap to define a leaflet.</li>
<li>It can be useful to select the whole molecule if a single atom falls in your definition.</li>
<li>Use the MDAnalysis help.</li>
<li>Perform the growth in the voxel grid using scipy.ndimage.binary_dilation(mode=‘wrap’) is another way to go.</li>
<li>Check out tutorial 2 to see if you definition holds up :D</li>
</ul>
</section>
<section id="assignment-3-be-creative-and-change-the-solvent" class="level2">
<h2 class="anchored" data-anchor-id="assignment-3-be-creative-and-change-the-solvent">Assignment 3: Be Creative and Change the Solvent</h2>
<p>Being able to select objects with their content means it should be trivial with all your knowledge of Martini by now to exchange the water inside the bicelle with some alcohol.</p>
<ul>
<li>Make use Bentopy or Polyply to get it done?</li>
</ul>
</section>
</section>
<section id="flex-plotting-containment" class="level1">
<h1>Flex Plotting Containment</h1>
<p>This code might not run as you might not have widgets installed. You can install it by running the following commands in your terminal.</p>
<pre><code>$micromamba activate MDWORKSHOP # Or how your environment might be named
$pip install ipywidgets</code></pre>
A static teaser of what the advanced plotting looks like.
<center>
<img src="example_advanced_plotting_names.png" width="800">
</center>
<div class="alert alert-block alert-info">
<p><b>Tip:</b> You can hover over the composition bars to inspect the specifics of that segment.</p>
</div>
<div class="sourceCode" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>compositions_names <span class="op">=</span> cl.get_compositions(containment, mode<span class="op">=</span><span class="st">'names'</span>)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>show_containment_with_composition(u, containment.voxel_containment, compositions_names, mode<span class="op">=</span><span class="st">'names'</span>, max_display_items<span class="op">=</span><span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>VBox(children=(VBox(children=(HBox(children=(HTML(value="&lt;b&gt;Comp. -2&lt;/b&gt; &amp;nbsp;&amp;nbsp;&lt;span style='color:gray'&gt;…</code></pre>
<div class="sourceCode" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>compositions_resnames <span class="op">=</span> cl.get_compositions(containment, mode<span class="op">=</span><span class="st">'resnames'</span>)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>show_containment_with_composition(u, containment.voxel_containment, compositions_resnames, <span class="st">'resnames'</span>, max_display_items<span class="op">=</span><span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>VBox(children=(VBox(children=(HBox(children=(HTML(value="&lt;b&gt;Comp. -2&lt;/b&gt; &amp;nbsp;&amp;nbsp;&lt;span style='color:gray'&gt;…</code></pre>
<div class="sourceCode" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>compositions_molar <span class="op">=</span> cl.get_compositions(containment, mode<span class="op">=</span><span class="st">'molar'</span>)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>show_containment_with_composition(u, containment.voxel_containment, compositions_molar, mode<span class="op">=</span><span class="st">'molar'</span>, max_display_items<span class="op">=</span><span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>VBox(children=(VBox(children=(HBox(children=(HTML(value="&lt;b&gt;Comp. -2&lt;/b&gt; &amp;nbsp;&amp;nbsp;&lt;span style='color:gray'&gt;…</code></pre>
</section>
<section id="conclusion-1" class="level1">
<h1>Conclusion</h1>
<p>You can use MDVContainment to analyse your systems in a hierarchical manner. It allows you to specify your selections in a much more robust manner allowing for high throughput data analysis.</p>
<div class="alert alert-block alert-info">
<p><b>Tip:</b> Check out the other MDVContainment tutorials for an alternative approach to voxel labeling, using a more sophisticated density based approach (tutorial 2). Or even perform labeling without any selection at all (tutorial 3)!</p>
</div>
<p>For any questions/remarks/thanks/etc. please make an issue at the github repo: <a href="https://github.com/BartBruininks/mdvcontainment">https://github.com/BartBruininks/mdvcontainment</a></p>
<p>Cite the preprint when using this work:</p>
<pre><code>Classification of containment hierarchy for point clouds in periodic space
Bart Marlon Herwig Bruininks, Ilpo Vattulainen
https://doi.org/10.1101/2025.08.06.668936</code></pre>
<section id="answers-to-the-questions" class="level2">
<h2 class="anchored" data-anchor-id="answers-to-the-questions">Answers to the Questions</h2>
<ol type="1">
<li>The positive labels are the ones which annotate the selected voxels, so component 1.</li>
<li>Component -1 is contained by component 1 (the arrow points from 1 to -1).</li>
<li>Components of rank 1 would be volumetric curves (a topological wire) spanning the PBC.</li>
<li>There are 40x40x40 = 64000 voxels in total in the grid.</li>
<li>Yes, a root node can be a leaf node</li>
<li>If the voxel perfectly tile the box, the voxel grid is translational invariant under integer translations.</li>
<li>The PBC are taken into account for mesh generation, as no triangles are added at the box ‘boundaries’. However, duplicate vertex positions exist for vertices at the boundaries (not properly identified). This can be fixed, but would mess with the area calculations, so be careful.</li>
<li>By using containment to generate specific meshes, we keep our handles on the resulting meshes, allowing us to identify which densities cause which areas without opportunistic guessing.</li>
</ol>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/cgmartini\.nl");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<div class="footer-left">

</div>
</div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/cg_martini">
      <i class="bi bi-twitter" role="img" aria-label="Martini Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="../../../../docs/faq/index.html">
<p><iconify-icon inline="true" role="img" icon="hugeicons:help-circle" style="font-size: 1.25em;" aria-label="FAQs" title="FAQs"></iconify-icon></p>
</a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Martini-Force-Field-Initiative">
      <i class="bi bi-github" role="img" aria-label="Martini GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
<div class="footer-right">
© 2025 Martini Force Field Initiative <img src="https://cgmartini-library.s3.ca-central-1.amazonaws.com/icon.png" alt="Icon">
</div>
</div>
  </div>
</footer>
<script>
    document.addEventListener('DOMContentLoaded', (event) => {
      const quotes = [
          "<i>Shaken, not stirred.</i> - James Bond",
          "<i>He was white and shaken, like a dry martini.</i> - P. G. Wodehouse",      
          "<i>I think people think we're all sipping martinis by the pool.</i> - Maria Menounos",
          "<i>Why don't you get out of that wet coat and into a dry martini?</i> - Robert Benchley",
          "<i>Really, can anyone drink several martinis at lunch?</i> - Christine Baranski",
          "<i>Zen martini: A martini with no vermouth at all. And no gin, either.</i> - P.J. O'Rourke",
          "<i>I never go jogging, it makes me spill my martini.</i> - George Burns",
          "<i>Martinis are the only American invention as perfect as a sonnet.</i> - H. L. Mencken",
          "<i>He knows just how I like my martini: full of alcohol.</i> - Homer Simpson",
          "<i>Happiness is: finding olives in your martini when you're hungry.</i> - Johnny Carson",
          "<i>If it wasn't for the olives in his martinis he'd starve to death.</i> - Milton Berle",
        ];
      const randomIndex = Math.floor(Math.random() * quotes.length);
      const randomQuote = quotes[randomIndex];

      const footerLeft = document.querySelector('.footer-left');
      if (footerLeft) {
          footerLeft.innerHTML = randomQuote;
      }
    });
</script>
<script src="../../../../js/sidebar-close.js"></script> 




</body></html>