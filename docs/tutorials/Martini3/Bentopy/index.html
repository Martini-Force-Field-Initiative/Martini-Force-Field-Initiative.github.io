<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Bentopy: from simple packing to building cellular models ‚Äì Martini Force Field Initiative</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../">
<link href="../../../../images/favicon.png" rel="icon" type="image/png">
<script src="../../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../site_libs/bootstrap/bootstrap-9f0cf1623f84fc97d1f11599d85dd00d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="../../../../site_libs/quarto-contrib/iconify-2.1.0/iconify-icon.min.js"></script>
<link href="../../../../site_libs/quarto-contrib/fontawesome6-1.2.0/all.min.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-contrib/fontawesome6-1.2.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script>
    document.addEventListener('DOMContentLoaded', (event) => {
      const quotes = [
          "<i>Shaken, not stirred.</i> - James Bond",
          "<i>He was white and shaken, like a dry martini.</i> - P. G. Wodehouse",      
          "<i>I think people think we're all sipping martinis by the pool.</i> - Maria Menounos",
          "<i>Why don't you get out of that wet coat and into a dry martini?</i> - Robert Benchley",
          "<i>Really, can anyone drink several martinis at lunch?</i> - Christine Baranski",
          "<i>Zen martini: A martini with no vermouth at all. And no gin, either.</i> - P.J. O'Rourke",
          "<i>I never go jogging, it makes me spill my martini.</i> - George Burns",
          "<i>Martinis are the only American invention as perfect as a sonnet.</i> - H. L. Mencken",
          "<i>He knows just how I like my martini: full of alcohol.</i> - Homer Simpson",
          "<i>Happiness is: finding olives in your martini when you're hungry.</i> - Johnny Carson",
          "<i>If it wasn't for the olives in his martinis he'd starve to death.</i> - Milton Berle",
        ];
      const randomIndex = Math.floor(Math.random() * quotes.length);
      const randomQuote = quotes[randomIndex];

      const footerLeft = document.querySelector('.footer-left');
      if (footerLeft) {
          footerLeft.innerHTML = randomQuote;
      }
    });
</script>


<link rel="stylesheet" href="../../../../styles.css">
<meta property="og:title" content="Bentopy: from simple packing to building cellular models ‚Äì Martini Force Field Initiative">
<meta property="og:description" content="">
<meta property="og:image" content="https://cgmartini.nl/docs/tutorials/Martini3/Bentopy/logo_header.png">
<meta property="og:site_name" content="Martini Force Field Initiative">
<meta property="og:image:height" content="829">
<meta property="og:image:width" content="1919">
<meta name="twitter:title" content="Bentopy: from simple packing to building cellular models ‚Äì Martini Force Field Initiative">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://cgmartini.nl/docs/tutorials/Martini3/Bentopy/logo_header.png">
<meta name="twitter:image-height" content="829">
<meta name="twitter:image-width" content="1919">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../../images/martini.gif" alt="martini logo" class="navbar-logo light-content">
    <img src="../../../../images/martini.gif" alt="martini logo" class="navbar-logo dark-content">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../index.html"> <i class="bi bi-house-fill" role="img">
</i> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../../../../docs/tutorials/index.html" aria-current="page"> <i class="bi bi-mortarboard-fill" role="img">
</i> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../docs/downloads/index.html"> <i class="bi bi-download" role="img">
</i> 
<span class="menu-text">Downloads</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../docs/publications/index.html"> <i class="bi bi-newspaper" role="img">
</i> 
<span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../docs/announcements/index.html"> 
<span class="menu-text"><i class="fa-solid fa-bullhorn" aria-label="bullhorn"></i> Announcements</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../docs/contact/index.html"> 
<span class="menu-text"><i class="fa-regular fa-address-book" aria-label="address-book"></i> Contact</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-fa-circle-info--help" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text"><i class="fa-solid fa-circle-info" aria-label="circle-info"></i> Help</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-fa-circle-info--help">    
        <li>
    <a class="dropdown-item" href="https://github.com/orgs/Martini-Force-Field-Initiative/discussions"><i class="bi bi-chat-right-text" role="img">
</i> 
 <span class="dropdown-text">Discussion Board</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/orgs/Martini-Force-Field-Initiative/discussions"><i class="bi bi-bug" role="img">
</i> 
 <span class="dropdown-text">Report an Issue</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../docs/faq/index.html"><i class="bi bi-question-circle" role="img">
</i> 
 <span class="dropdown-text">FAQs</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://github.com/Martini-Force-Field-Initiative" title="Martini GitHub" class="quarto-navigation-tool px-1" aria-label="Martini GitHub"><i class="bi bi-github"></i></a>
    <a href="https://x.com/cg_martini" title="Martini Twitter" class="quarto-navigation-tool px-1" aria-label="Martini Twitter"><i class="bi bi-twitter-x"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Bentopy: from simple packing to building cellular models</li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../docs/tutorials/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><b>Summary</b></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../docs/tutorials/Martini3/workshop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">üìö Workshop 2025</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../docs/tutorials/Martini3/lectures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">üéì Martini Lectures</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../docs/tutorials/Martini3/tutorials.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">üõ†Ô∏è Hands-on Tutorials</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../docs/tutorials/Legacy/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">üï∏Ô∏è Legacy Material</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#summary" id="toc-summary" class="nav-link active" data-scroll-target="#summary">Summary</a></li>
  <li><a href="#Introduction" id="toc-Introduction" class="nav-link" data-scroll-target="#Introduction">Introduction</a></li>
  <li><a href="#Programs" id="toc-Programs" class="nav-link" data-scroll-target="#Programs">Programs and files</a></li>
  <li><a href="#Tut1" id="toc-Tut1" class="nav-link" data-scroll-target="#Tut1">Tutorial 1: Basic Packing in Empty Space</a></li>
  <li><a href="#Tut2" id="toc-Tut2" class="nav-link" data-scroll-target="#Tut2">Tutorial 2: Packing Around Existing Structures</a></li>
  <li><a href="#Tut3" id="toc-Tut3" class="nav-link" data-scroll-target="#Tut3">Tutorial 3: Multi-Compartment Systems with Placement Rules</a></li>
  <li><a href="#Advanced_Features_and_Tips" id="toc-Advanced_Features_and_Tips" class="nav-link" data-scroll-target="#Advanced_Features_and_Tips">Advanced Features and Tips</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Bentopy: from simple packing to building cellular models</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<hr>
<p><strong>Tutorial authors:</strong> J.A. Stevens and M.S.S. Westendorp, with contributions from Bart M.H. Bruininks, C.M. Brown and W.J. Nauta.<br>
<strong>In case of issues:</strong> Please contact <a href="mailto:m.s.s.westendorp@rug.nl" class="email">m.s.s.westendorp@rug.nl</a> or <a href="mailto:jaste@illinois.edu" class="email">jaste@illinois.edu</a>.</p>
<hr>
<section id="summary" class="level3">
<h3 class="anchored" data-anchor-id="summary">Summary</h3>
<ul>
<li><a href="#Introduction"><code>Introduction</code></a></li>
<li><a href="#Programs"><code>Programs</code></a></li>
<li><a href="#Tut1"><code>Tutorial 1: Basic Packing in Empty Space</code></a></li>
<li><a href="#Tut2"><code>Tutorial 2: Packing Around Existing Structures</code></a></li>
<li><a href="#Tut3"><code>Tutorial 3: Multi-Compartment Systems with Placement Rules</code></a></li>
<li><a href="#Advanced_Features_and_Tips"><code>Advanced Features and Tips</code></a></li>
<li><a href="#references"><code>References</code></a></li>
</ul>
<p><em>The following video is a walkthrough of this tutorial.</em></p>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/C4LYZokS_t4" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
</section>
<section id="Introduction" class="level3">
<h3 class="anchored" data-anchor-id="Introduction">Introduction</h3>
<hr>
<div id="fig-logo-header" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-logo-header-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="logo_header.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-logo-header-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: The bentopy logo, packed with bentopy. Those interested in how this model was constructed may enjoy this <a href="https://hachyderm.io/@ma3ke/114081904829438250">thread on the making of this model</a>.
</figcaption>
</figure>
</div>
<p><em>Bentopy</em> is a tool for packing molecules in arbitrary volumes, designed specifically for setting up large-scale molecular dynamics (MD) simulations <span class="citation" data-cites="westendorp_bentopy_2026">(<a href="#ref-westendorp_bentopy_2026" role="doc-biblioref">Westendorp et al., 2026</a>)</span>. Through an efficient packing algorithm, <em>bentopy</em> can assemble molecular structures into MD models with biological densities and cellular-scales.</p>
<p><em>Bentopy</em> was built to create cellular-scale models by integrating multiple structural components at physiological concentrations while ensuring simulation compatibility (<a href="#fig-mito" class="quarto-xref">Figure&nbsp;2</a>). <em>Bentopy</em> uses voxels to represent space as a regular 3D grid, providing computational efficiency for spatial operations like collision detection and informing molecule placement. For example, this voxel approach enables MDVContainment <span class="citation" data-cites="bruininks_mdvcontainment_2025">(<a href="#ref-bruininks_mdvcontainment_2025" role="doc-biblioref">Bruininks &amp; Vattulainen, 2025</a>)</span> to automatically identify compartments within molecular models for packing, which is a central feature of <em>bentopy</em>.</p>
<div id="fig-mito" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-mito-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figure_mito.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mito-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Showcase models. Mitochondrial model, showing distinct compartments with compartment-specific molecular components. Reproduced from <span class="citation" data-cites="westendorp_bentopy_2026">Westendorp et al. (<a href="#ref-westendorp_bentopy_2026" role="doc-biblioref">2026</a>)</span>.
</figcaption>
</figure>
</div>
<p>In this tutorial, we will showcase <em>bentopy</em>‚Äôs capabilities through three progressively complex tutorials that build on each other (<a href="#fig-progression" class="quarto-xref">Figure&nbsp;3</a>).</p>
<ol type="1">
<li><a href="#Tut1"><strong>Simple packing</strong></a>: Learn the basic workflow by packing proteins in empty space.</li>
<li><a href="#Tut2"><strong>Packing around existing structures</strong></a>: Add a membrane and pack proteins around it.</li>
<li><a href="#Tut3"><strong>Multi-compartment systems</strong></a>: Add a second membrane creating distinct compartments for different proteins.</li>
</ol>
<div id="fig-progression" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-progression-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figure_progression.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-progression-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Tutorial progression from simple protein packing to complex multi-compartment systems.
</figcaption>
</figure>
</div>
<p>Each tutorial builds on the previous one, showing how to evolve a simple system into a complex model while using the standard <em>bentopy</em> workflow (<a href="#fig-workflow" class="quarto-xref">Figure&nbsp;7</a>).</p>
</section>
<section id="Programs" class="level3">
<h3 class="anchored" data-anchor-id="Programs">Programs and files</h3>
<hr>
<section id="installing-bentopy" class="level4">
<h4 class="anchored" data-anchor-id="installing-bentopy">Installing <em>bentopy</em></h4>
<p><em>Bentopy</em> is available through the PyPI. Pre-built binaries are available for some platforms. In most cases, you can use <code>pip</code> to install it without any prior steps.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install bentopy</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<blockquote class="blockquote">
<p>This version of the tutorial was written for <em>bentopy</em> v1.0.0. If necessary, you can pin the version using <code>pip install bentopy==1.0.0</code>.</p>
</blockquote>
<p>If this installation fails at first, this may be because a pre-built binary is not available for your platform. To allow <code>pip</code> to build <em>bentopy</em>, <code>cargo</code> is required, which provides the Rust compiler.</p>
<p>You can try to see if it is already present on your system.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">cargo</span> <span class="at">--version</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>If not present, <a href="https://www.rust-lang.org/learn/get-started">install Rust</a> through <a href="https://rustup.rs/">Rustup</a>.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>After installing Rust via rustup, you may need to reload your shell environment for the Rust tools (<code>cargo</code>, etc.) to be available in your PATH. Though you can reload your shell configuration by sourcing e.g., <code>~/.bashrc</code>, opening a new terminal is most reliable.</p>
<p>You can verify whether the installation was successful by running <code>cargo --version</code>.</p>
</div>
</div>
<p>Now you can install <em>bentopy</em> directly via <code>pip</code> as described earlier.</p>
</section>
<section id="download-tutorial-files" class="level4">
<h4 class="anchored" data-anchor-id="download-tutorial-files">Download tutorial files</h4>
<p>Before starting the tutorial, download the required structure and parameter files. You download the <a href="https://cgmartini-library.s3.ca-central-1.amazonaws.com/0_Tutorials/m3_tutorials/Bentopy/tutorial_files.tar.gz">tutorial files</a> and extract them.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> <span class="st">'https://cgmartini-library.s3.ca-central-1.amazonaws.com/0_Tutorials/m3_tutorials/Bentopy/tutorial_files.tar.gz'</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tar</span> <span class="at">-xzf</span> tutorial_files.tar.gz</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> tutorial_files</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This archive contains structures, force field parameters, and simulation files.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 19%">
<col style="width: 80%">
</colgroup>
<tbody>
<tr class="odd">
<td><code>structures/</code></td>
<td>Provided structure files: proteins (<code>lysozyme.pdb</code>, <code>ubiquitin.pdb</code>) and membranes (<code>membrane.gro</code>, <code>double_membrane.gro</code>)</td>
</tr>
<tr class="even">
<td><code>topology/</code></td>
<td>Martini force field files and protein topologies (<code>lysozyme.itp</code>, <code>ubiquitin.itp</code>)</td>
</tr>
<tr class="odd">
<td><code>mdp_files/</code></td>
<td>Example Gromacs input files (<code>em.mdp</code>, <code>eq.mdp</code>, <code>md.mdp</code>)</td>
</tr>
</tbody>
</table>
</section>
<section id="other-tools" class="level4">
<h4 class="anchored" data-anchor-id="other-tools">Other tools</h4>
<ul>
<li>Standard command line tools.</li>
<li>Visualization software: <strong><code>VMD</code></strong>.</li>
</ul>
</section>
</section>
<section id="Tut1" class="level3">
<h3 class="anchored" data-anchor-id="Tut1">Tutorial 1: Basic Packing in Empty Space</h3>
<hr>
<section id="overview" class="level4">
<h4 class="anchored" data-anchor-id="overview">Overview</h4>
<p>We begin with the basic <em>bentopy</em> workflow by packing proteins into a simple cubic space. This tutorial introduces:</p>
<ul>
<li>The <code>.bent</code> input file.</li>
<li>Analytical mask definitions.</li>
<li>The <code>bentopy-pack</code>, <code>bentopy-render</code> and <code>bentopy-solvate</code> commands.</li>
</ul>
</section>
<section id="create-the-packing-configuration" class="level4">
<h4 class="anchored" data-anchor-id="create-the-packing-configuration">Create the packing configuration</h4>
<p><em>Bentopy</em> uses input configuration files to define packing parameters, called <code>.bent</code> files. These input files act as recipes for building different systems. They have a format that may be familiar to Gromacs users, but is also designed to be approachable and readable. Create a file called <code>simple_packing.bent</code> with the following contents.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>simple_packing.bent</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4" data-filename="simple_packing.bent"><pre class="sourceCode ini code-with-copy"><code class="sourceCode ini"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[ general ]</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="dt">title "Proteins in a box"</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="dt">seed 0</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="kw">[ space ]</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># All dimensions in bentopy are given in nanometers.</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="dt">dimensions 40, 40, 40</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="dt">resolution 0.5</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="kw">[ includes ]</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="dt">"topology/martini_v3.0.0.itp"</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="dt">"topology/martini_v3.0.0_ions_v1.itp"</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="dt">"topology/martini_v3.0.0_solvents_v1.itp"</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="dt">"topology/lysozyme.itp"</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="kw">[ compartments ]</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="dt">system is all</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="kw">[ segments ]</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="dt">LYZ 650 from "structures/lysozyme.pdb" in system</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Let‚Äôs discuss the key parts in this <em>bentopy</em> recipe.</p>
<dl>
<dt>General section</dt>
<dd>
Sets general information, such as the system and a random seed.
</dd>
<dd>
In this case, we use a defined seed to make sure that the results are repeatable. When the seed is not set, a random seed will be used at runtime.
</dd>
<dt>Space section</dt>
<dd>
Defines a 40√ó40√ó40 nm¬≥ simulation box with 0.5 nm voxel resolution.
</dd>
<dt>Includes section</dt>
<dd>
Specifies topology files for Gromacs compatibility. These files will be included when we generate the final topology with <code>bentopy-render</code>.
</dd>
<dt>Compartments section</dt>
<dd>
Defines the compartments that are available for placing segments.
</dd>
<dd>
In this case, declare a compartment called ‚Äúsystem‚Äù, which spans the entire space.
</dd>
<dt>Segments section</dt>
<dd>
Defines what structures are to be packed into what compartments and at what quantities.
</dd>
<dd>
In this case, declare 650 lysozyme proteins to be randomly placed in the ‚Äúsystem‚Äù compartment.
</dd>
<dd>
Note that the segment name ‚ÄúLYZ‚Äù refers to the name of the topology described in <code>topology/lysozyme.itp</code>.
</dd>
</dl>
</section>
<section id="pack-the-system" class="level4">
<h4 class="anchored" data-anchor-id="pack-the-system">Pack the system</h4>
<p>Now we can pack this system.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">bentopy-pack</span> simple_packing.bent placements.json</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The output file <code>placements.json</code> contains all the placement information in a lightweight instance-based file format. We call this the <em>placement list</em>.</p>
</section>
<section id="render-the-structure" class="level4">
<h4 class="anchored" data-anchor-id="render-the-structure">Render the structure</h4>
<p>We can convert the placement list to a coordinate file.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">bentopy-render</span> placements.json system.gro <span class="at">-t</span> topol.top</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This creates <code>system.gro</code> with all protein coordinates and <code>topol.top</code> with the simulation topology.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Splitting the computationally intensive packing step from the process of writing out the entire coordinate file allows for more efficient workflows with large systems. This workflow also improves the shareability of models, as distributing the lightweight placement file is orders of magnitude more efficient than sharing the complete coordinate file.</p>
</div>
</div>
</section>
<section id="solvation" class="level4">
<h4 class="anchored" data-anchor-id="solvation">Solvation</h4>
<p>Finally, we add water and ions to complete the system preparation.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="annotated-cell-7"><pre class="sourceCode bash code-annotation-code code-with-copy code-annotated"><code class="sourceCode bash"><span id="annotated-cell-7-1"><a href="#annotated-cell-7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">bentopy-solvate</span> <span class="at">-i</span> system.gro <span class="at">-o</span> solvated_system.gro <span class="dt">\</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-7-2" class="code-annotation-target"><a href="#annotated-cell-7-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">-s</span> NA:0.15M <span class="at">-s</span> CL:0.15M                      <span class="dt">\</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-7-3" class="code-annotation-target"><a href="#annotated-cell-7-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">--charge</span> neutral                             <span class="dt">\</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-7-4" class="code-annotation-target"><a href="#annotated-cell-7-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">-t</span> topol.top</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-7" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="2" data-code-annotation="1">Add 150 mM NaCl by substituting accepted water placements.</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="3" data-code-annotation="2">Neutralize the system charge by substituting additional ions. With the <code>neutral</code> option, the total system charge is automatically determined if a topology file is provided. This means that, on top of the ions substituted for the 150 mM NaCl, additional charge-neutralizing ions are added.</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="4" data-code-annotation="3">Append the solvent contents to the topology file.</span>
</dd>
</dl>
<p>We have now created a fully solvated system with 150 mM NaCl concentration and neutralized the system charge, ready for MD simulation.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>bentopy-solvate</code> is specifically designed and optimized for solvating large-scale models with millions or billions of particles, where traditional solvation tools become impractically slow. Yet, it is easy to use for more modest systems like this one as well.</p>
</div>
</div>
</section>
<section id="visualization-and-analysis" class="level4">
<h4 class="anchored" data-anchor-id="visualization-and-analysis">Visualization and analysis</h4>
<p>Open the system with <code>VMD</code> to inspect our current model.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">vmd</span> solvated_system.gro</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The result should be similar to the snapshot shown below, you can observe:</p>
<ul>
<li>The lysozyme proteins are distributed uniformly throughout the simulation box.</li>
<li>The lysozyme proteins are packed at cytoplasmic densities. No overlap between proteins.</li>
</ul>
<div id="fig-tutorial-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-tutorial-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figure_tutorial_1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-tutorial-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Basic protein packing. Lysozyme proteins packed in a cubic box with water and ions with non-overlapping placements
</figcaption>
</figure>
</div>
</section>
<section id="try-a-different-analytical-mask" class="level4">
<h4 class="anchored" data-anchor-id="try-a-different-analytical-mask">Try a different analytical mask</h4>
<details>
<summary>
Learn how to use different shapes, such as spheres and cuboids, to construct compartments.
</summary>
<p>Before moving to the next tutorial, you can experiment a bit by trying a different analytical compartment shape. Simply replace the compartment definition in your <code>simple_packing.bent</code> file to pack proteins inside a sphere instead of the entire space.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>simple_packing.bent</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8" data-filename="simple_packing.bent"><pre class="sourceCode ini code-with-copy"><code class="sourceCode ini"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[ compartments ]</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="dt">system as sphere at center with radius 20</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Similarly, you can declare a space as a smaller cuboid as well.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>simple_packing.bent</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9" data-filename="simple_packing.bent"><pre class="sourceCode ini code-with-copy"><code class="sourceCode ini"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[ compartments ]</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="dt">system as cuboid from 10, 10, 10 to 30, 30, 30</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that the available space to pack proteins has become smaller, so not all the requested proteins were placed. <em>Bentopy</em> indicated this with the remark ‚Äò&lt;‚Äô in the packing summary that gets printed to your terminal. It‚Äôs advised to save this summary to a file as it contains all the relevant packing information for your project.</p>
</div>
</div>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output from bentopy-pack</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10" data-filename="Output from bentopy-pack"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>Setting up compartments...</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>Loading segment structures...</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>Rearranging segments according to the Moment method... Done.</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>(  1/1) Attempting to pack   650 instances of segment 'LYZ'.</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>Packing process took 0.091 s.</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>idx     name           ok%  target  placed  time (s)    remark</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>----    ----------  ------  ------  ------  --------    ------</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>   0    LYZ          50.8%     650     330      0.09    &lt;</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>                     50.8%     650     330      0.09    &lt;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>Writing placement list to "placements.json"... Done in 0.003 s.</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</details>
</section>
</section>
<section id="Tut2" class="level3">
<h3 class="anchored" data-anchor-id="Tut2">Tutorial 2: Packing Around Existing Structures</h3>
<hr>
<section id="overview-1" class="level4">
<h4 class="anchored" data-anchor-id="overview-1">Overview</h4>
<p>In this tutorial, we will add a membrane. We treat this membrane as excluded volume, ensuring proteins are not placed within it. We will also introduce packing rules to place specific proteins close to the membrane surface. This tutorial introduces:</p>
<ul>
<li>Compartment definitions using voxel masks generated from existing structures.</li>
<li>Proximity-based placement rules.</li>
<li>The <code>bentopy-mask</code> and <code>bentopy-merge</code> commands.</li>
</ul>
</section>
<section id="inspect-the-mask-compartments" class="level4">
<h4 class="anchored" data-anchor-id="inspect-the-mask-compartments">Inspect the mask compartments</h4>
<p>Before creating masks, it‚Äôs essential to understand what compartments <em>bentopy</em> identifies in your system. First, generate a visualization file to inspect the compartments identified in the voxel representation.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">bentopy-mask</span> structures/membrane.gro <span class="at">--visualize-labels</span> labels.gro</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This automatically generates a structure file called <code>labels.gro</code> that contains a bead at every voxel position. Each voxel bead is named after the compartment it resides in. Visualize the voxel representation of our membrane system by opening the file with VMD.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">vmd</span> labels.gro</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Here you can use the following atom selections to visualize the identified compartments:</p>
<ul>
<li><strong>Solvent regions</strong> (‚Äúoutside‚Äù, available for packing): <code>name "-1"</code>.</li>
<li><strong>Membrane region</strong> (excluded from packing): <code>name 1</code>.</li>
</ul>
<p>The negative label (-1) typically represents the outermost compartment (solvent), while positive labels (1) represent inner or solid structures (membrane). Understanding these labels is important for selecting the correct compartments for protein placement.</p>
</section>
<section id="create-the-mask" class="level4">
<h4 class="anchored" data-anchor-id="create-the-mask">Create the mask</h4>
<p>Now that you understand the compartments, we will create the mask to guide our protein placement. Here, we create a mask called <code>membrane_mask.npz</code> from compartment <code>1</code>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">bentopy-mask</span> structures/membrane.gro <span class="at">-l</span> 1:membrane_mask.npz</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="a-new-recipe" class="level4">
<h4 class="anchored" data-anchor-id="a-new-recipe">A new recipe</h4>
<p>Now we create a new <em>bentopy</em> recipe to use the membrane mask and include proximity rule. Create <code>membrane_packing.bent</code> as follows.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>membrane_packing.bent</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="annotated-cell-15" data-filename="membrane_packing.bent"><pre class="sourceCode ini code-annotation-code code-with-copy code-annotated"><code class="sourceCode ini"><span id="annotated-cell-15-1"><a href="#annotated-cell-15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[ general ]</span></span>
<span id="annotated-cell-15-2"><a href="#annotated-cell-15-2" aria-hidden="true" tabindex="-1"></a><span class="dt">title "Proteins around a membrane"</span></span>
<span id="annotated-cell-15-3"><a href="#annotated-cell-15-3" aria-hidden="true" tabindex="-1"></a><span class="dt">seed 0</span></span>
<span id="annotated-cell-15-4"><a href="#annotated-cell-15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-15-5"><a href="#annotated-cell-15-5" aria-hidden="true" tabindex="-1"></a><span class="kw">[ space ]</span></span>
<span id="annotated-cell-15-6"><a href="#annotated-cell-15-6" aria-hidden="true" tabindex="-1"></a><span class="dt">dimensions 40, 40, 40</span></span>
<span id="annotated-cell-15-7"><a href="#annotated-cell-15-7" aria-hidden="true" tabindex="-1"></a><span class="dt">resolution 0.5</span></span>
<span id="annotated-cell-15-8"><a href="#annotated-cell-15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-15-9"><a href="#annotated-cell-15-9" aria-hidden="true" tabindex="-1"></a><span class="kw">[ includes ]</span></span>
<span id="annotated-cell-15-10"><a href="#annotated-cell-15-10" aria-hidden="true" tabindex="-1"></a><span class="dt">"topology/martini_v3.0.0.itp"</span></span>
<span id="annotated-cell-15-11"><a href="#annotated-cell-15-11" aria-hidden="true" tabindex="-1"></a><span class="dt">"topology/martini_v3.0.0_ions_v1.itp"</span></span>
<span id="annotated-cell-15-12"><a href="#annotated-cell-15-12" aria-hidden="true" tabindex="-1"></a><span class="dt">"topology/martini_v3.0.0_solvents_v1.itp"</span></span>
<span id="annotated-cell-15-13"><a href="#annotated-cell-15-13" aria-hidden="true" tabindex="-1"></a><span class="dt">"topology/martini_v3.0.0_phospholipids_v1.itp"</span></span>
<span id="annotated-cell-15-14"><a href="#annotated-cell-15-14" aria-hidden="true" tabindex="-1"></a><span class="dt">"topology/lysozyme.itp"</span></span>
<span id="annotated-cell-15-15"><a href="#annotated-cell-15-15" aria-hidden="true" tabindex="-1"></a><span class="dt">"topology/ubiquitin.itp"</span></span>
<span id="annotated-cell-15-16"><a href="#annotated-cell-15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-15-17"><a href="#annotated-cell-15-17" aria-hidden="true" tabindex="-1"></a><span class="kw">[ compartments ]</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-15" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-15-18" class="code-annotation-target"><a href="#annotated-cell-15-18" aria-hidden="true" tabindex="-1"></a><span class="dt">membrane from "membrane_mask.npz"</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-15" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-15-19" class="code-annotation-target"><a href="#annotated-cell-15-19" aria-hidden="true" tabindex="-1"></a><span class="dt">solvent combines not membrane</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-15" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-15-20" class="code-annotation-target"><a href="#annotated-cell-15-20" aria-hidden="true" tabindex="-1"></a><span class="dt">close-to-membrane around 5 of membrane</span></span>
<span id="annotated-cell-15-21"><a href="#annotated-cell-15-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-15-22"><a href="#annotated-cell-15-22" aria-hidden="true" tabindex="-1"></a><span class="kw">[ segments ]</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-15" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-15-23" class="code-annotation-target"><a href="#annotated-cell-15-23" aria-hidden="true" tabindex="-1"></a><span class="dt">LYZ:lyz 300 from "structures/lysozyme.pdb" in solvent</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-15" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-15-24" class="code-annotation-target"><a href="#annotated-cell-15-24" aria-hidden="true" tabindex="-1"></a><span class="dt">UBQ:ubq 100 from "structures/ubiquitin.pdb" in close-to-membrane</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-15" data-target-annotation="6" onclick="event.preventDefault();">6</a><span id="annotated-cell-15-25" class="code-annotation-target"><a href="#annotated-cell-15-25" aria-hidden="true" tabindex="-1"></a><span class="co"># The part after the segment name is the optional tag (&lt;name&gt;:&lt;tag&gt;).</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-15" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="18" data-code-annotation="1">We load the mask from the file we created earlier.</span>
</dd>
<dt data-target-cell="annotated-cell-15" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="19" data-code-annotation="2">We define the ‚Äúsolvent‚Äù region as the inverse (<code>not</code>) of ‚Äúmembrane‚Äù, using a <em>compartment combination</em>.</span>
</dd>
<dt data-target-cell="annotated-cell-15" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="20" data-code-annotation="3">To create a compartment for the region around the ‚Äúmembrane‚Äù compartment, we use the <code>around</code> rule.</span>
</dd>
<dt data-target-cell="annotated-cell-15" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="23" data-code-annotation="4">Reduced total protein numbers (due to the membrane, there is less accessible space).</span>
</dd>
<dt data-target-cell="annotated-cell-15" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="24" data-code-annotation="5">Added ubiquitin with a proximity rule to stay within 5 nm of the membrane surface, but not including the membrane itself. See the <a href="#Advanced_Features_and_Tips">Advanced Features section</a> for more information on creating complex compartment combinations.</span>
</dd>
<dt data-target-cell="annotated-cell-15" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="25" data-code-annotation="6">Added a tag for each structure, which will override the resnames in each segment for easier visualization. These are particularly helpful in more complex models, where the same structure (same name) can be placed in different compartments at different quantities. Adding multiple segment definitions with different tags can be quite useful.</span>
</dd>
</dl>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Using tags will override the original residue names in the gro file that <em>bentopy</em> outputs. While this makes visualization easier to inspect <em>bentopy</em> output (e.g., selecting all lysozyme with <code>resname lyz</code>), it may cause issues with analysis tools that expect standard residue names.</p>
<p>To instruct <code>bentopy-render</code> to ignore tag names, you can use the <code>--ignore-tags</code> flag.</p>
<p>Note that during MD simulation, Gromacs will automatically assign the correct chemical residue names based on the topology file, so simulation output will have proper residue naming.</p>
</div>
</div>
</section>
<section id="pack-the-system-1" class="level4">
<h4 class="anchored" data-anchor-id="pack-the-system-1">Pack the system</h4>
<p>Like before, we can now pack the system.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">bentopy-pack</span> membrane_packing.bent placements.json</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<section id="ordering-segments-during-placement" class="level5">
<h5 class="anchored" data-anchor-id="ordering-segments-during-placement">Ordering segments during placement</h5>
<p>This is a short aside on how <em>bentopy</em> orders segments during packing.</p>
<p>Now that we have introduced another structure, we can consider how <em>bentopy</em> is supposed to order these. Generally, larger structures are harder to pack because they have fewer possible positions and orientations within the available space. Moreover, when small structures were already placed somewhere, they may obstruct the placement of a larger structure that could have been placed there, while the smaller structure could have been placed in many other locations.</p>
<p>By default, <em>bentopy</em> uses a ‚Äògeometric moment‚Äô heuristic (moment of inertia, taking all particles to have a unit mass) to rank different structures by how tricky they are to pack. Larger structures will be placed before smaller structures.</p>
<p>If desired, you can change this behavior to any of the available options. To do this, you can add a <code>rearrange &lt;method&gt;</code> line to the input file, or use the <code>--rearrange &lt;method&gt;</code> flag.</p>
<p>The available rearrange methods and heuristics are</p>
<ul>
<li><code>moment</code>: orders by geometric moment, default,</li>
<li><code>volume</code>: orders by molecular volume</li>
<li><code>bounding-sphere</code>: orders by bounding sphere radius, and</li>
<li><code>none</code>: keeps the order specified in the input file.</li>
</ul>
<p>In our testing, the <code>moment</code> method works best for most systems, but for specific use cases it may be worth experimenting with other options.</p>
</section>
</section>
<section id="render-and-merge" class="level4">
<h4 class="anchored" data-anchor-id="render-and-merge">Render and merge</h4>
<p>Convert the placement list to a coordinate file and combine the packed proteins with the membrane structure.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">bentopy-render</span> placements.json packed_proteins.gro <span class="at">-t</span> topol.top</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate proteins with membrane structure</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="ex">bentopy-merge</span> packed_proteins.gro structures/membrane.gro <span class="at">-o</span> system.gro</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Add lipid molecules to the topology file.</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"POPC    5408"</span> <span class="op">&gt;&gt;</span> topol.top</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The <code>bentopy-merge</code> command appends the structure files for the original membrane to the packed proteins.</p>
</section>
<section id="solvation-1" class="level4">
<h4 class="anchored" data-anchor-id="solvation-1">Solvation</h4>
<p>Add water and ions to complete the system preparation:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">bentopy-solvate</span> <span class="at">-i</span> system.gro <span class="at">-o</span> solvated_system.gro <span class="at">-t</span> topol.top <span class="dt">\</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">-s</span> NA:0.15M <span class="at">-s</span> CL:0.15M <span class="at">--charge</span> neutral</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="visualization-and-analysis-1" class="level4">
<h4 class="anchored" data-anchor-id="visualization-and-analysis-1">Visualization and analysis</h4>
<p>Open the system with <code>VMD</code> to inspect the packing:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">vmd</span> solvated_system.gro</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Since we used tags, you can now use the selections <code>resname ubq</code> and <code>resname lyz</code> in VMD to select the ubiquitin and lysozyme proteins respectively.</p>
</div>
</div>
<p>The result should be similar to the snapshot shown below, you can observe:</p>
<ul>
<li>The lysozyme proteins are distributed throughout the aqueous regions.</li>
<li>The ubiquitin proteins concentrated near the membrane surfaces due to the proximity rule.</li>
<li>No protein overlaps with the membrane structure.</li>
</ul>
<div id="fig-tutorial-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-tutorial-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figure_tutorial_2.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-tutorial-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Membrane system with proximity rules. The membrane (gray) creates excluded volume, with lysozyme proteins (green) distributed throughout the solvent region and ubiquitin proteins (blue) concentrated near the membrane surface.
</figcaption>
</figure>
</div>
</section>
</section>
<section id="Tut3" class="level3">
<h3 class="anchored" data-anchor-id="Tut3">Tutorial 3: Multi-Compartment Systems with Placement Rules</h3>
<hr>
<section id="overview-2" class="level4">
<h4 class="anchored" data-anchor-id="overview-2">Overview</h4>
<p>Now we‚Äôll add even more complexity by creating a double membrane system that forms distinct compartments. Different proteins will be placed in different compartments. This tutorial demonstrates:</p>
<ul>
<li>Compartment-specific protein placement.</li>
</ul>
<p>We‚Äôll use the provided double membrane to create two distinct open compartments, then place different proteins in each compartment. <a href="#fig-workflow" class="quarto-xref">Figure&nbsp;7</a> contains a visual overview of how this system is constructed using the <em>bentopy</em> tools.</p>
</section>
<section id="inspect-the-double-membrane-structure" class="level4">
<h4 class="anchored" data-anchor-id="inspect-the-double-membrane-structure">Inspect the double membrane structure</h4>
<p>First, let‚Äôs examine the double membrane structure we‚Äôll be working with:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb18"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">vmd</span> structures/double_membrane.gro</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Notice how this system has two lipid bilayers, creating four distinct regions: two spaces between the two membranes, and the two membranes. We could conceive of one of the spaces between the membranes as being the ‚Äúoutside‚Äù, and take the other to be the ‚Äúinside‚Äù. Under that view, this structure could represent a compartmentalised space similar to a vesicle or double-layer cell wall. However, the two inter-membrane spaces cannot be distinguished, due to the periodic nature of our box. Distinguishing outside and inside is therefore not entirely accurate. We‚Äôll call them compartment <strong>A</strong> and <strong>B</strong>.</p>
</section>
<section id="create-compartment-specific-masks" class="level4">
<h4 class="anchored" data-anchor-id="create-compartment-specific-masks">Create compartment-specific masks</h4>
<p>Generate masks for the different compartments created by the double membrane like before. (We use the <code>-b</code> flag here which is short for <code>--visualize-labels</code>).</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">bentopy-mask</span> structures/double_membrane.gro <span class="at">-b</span> compartment_labels.gro</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Visualize the voxel representation of our membrane system by opening the file with VMD.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb20"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">vmd</span> compartment_labels.gro</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now also double-check the different spatial compartments identified by the containment algorithm:</p>
<ul>
<li>Compartment <strong>A</strong>: <code>name "-1"</code>.</li>
<li>Compartment <strong>B</strong>: <code>name "-2"</code>.</li>
<li>Membrane regions (excluded): <code>name 1 2</code>.</li>
</ul>
</section>
<section id="create-separate-masks-for-each-compartment" class="level4">
<h4 class="anchored" data-anchor-id="create-separate-masks-for-each-compartment">Create separate masks for each compartment</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">bentopy-mask</span> structures/double_membrane.gro <span class="dt">\</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">-l</span>  <span class="at">-1:A_mask.npz</span>                   <span class="dt">\</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">-l</span>  <span class="at">-2:B_mask.npz</span>                   <span class="dt">\</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">-l</span> 1,2:membrane_mask.npz</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>By adding multiple <code>-l</code> entries, we can write out all necessary mask files at once.</p>
</section>
<section id="update-the-configuration-with-compartments" class="level4">
<h4 class="anchored" data-anchor-id="update-the-configuration-with-compartments">Update the configuration with compartments</h4>
<p>Create a new configuration file <code>compartment_packing.bent</code> with multiple compartments and different protein compositions.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>compartment_packing.bent</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="annotated-cell-24" data-filename="compartment_packing.bent" data-highlighted="1"><pre class="sourceCode ini code-annotation-code code-with-copy code-annotated"><code class="sourceCode ini"><span id="annotated-cell-24-1"><a href="#annotated-cell-24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[ general ]</span></span>
<span id="annotated-cell-24-2"><a href="#annotated-cell-24-2" aria-hidden="true" tabindex="-1"></a><span class="dt">title "Proteins in different compartments"</span></span>
<span id="annotated-cell-24-3"><a href="#annotated-cell-24-3" aria-hidden="true" tabindex="-1"></a><span class="dt">seed 0</span></span>
<span id="annotated-cell-24-4"><a href="#annotated-cell-24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-24-5"><a href="#annotated-cell-24-5" aria-hidden="true" tabindex="-1"></a><span class="kw">[ space ]</span></span>
<span id="annotated-cell-24-6"><a href="#annotated-cell-24-6" aria-hidden="true" tabindex="-1"></a><span class="dt">dimensions 40, 40, 40</span></span>
<span id="annotated-cell-24-7"><a href="#annotated-cell-24-7" aria-hidden="true" tabindex="-1"></a><span class="dt">resolution 0.5</span></span>
<span id="annotated-cell-24-8"><a href="#annotated-cell-24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-24-9"><a href="#annotated-cell-24-9" aria-hidden="true" tabindex="-1"></a><span class="kw">[ includes ]</span></span>
<span id="annotated-cell-24-10"><a href="#annotated-cell-24-10" aria-hidden="true" tabindex="-1"></a><span class="dt">"topology/martini_v3.0.0.itp"</span></span>
<span id="annotated-cell-24-11"><a href="#annotated-cell-24-11" aria-hidden="true" tabindex="-1"></a><span class="dt">"topology/martini_v3.0.0_ions_v1.itp"</span></span>
<span id="annotated-cell-24-12"><a href="#annotated-cell-24-12" aria-hidden="true" tabindex="-1"></a><span class="dt">"topology/martini_v3.0.0_solvents_v1.itp"</span></span>
<span id="annotated-cell-24-13"><a href="#annotated-cell-24-13" aria-hidden="true" tabindex="-1"></a><span class="dt">"topology/martini_v3.0.0_phospholipids_v1.itp"</span></span>
<span id="annotated-cell-24-14"><a href="#annotated-cell-24-14" aria-hidden="true" tabindex="-1"></a><span class="dt">"topology/lysozyme.itp"</span></span>
<span id="annotated-cell-24-15"><a href="#annotated-cell-24-15" aria-hidden="true" tabindex="-1"></a><span class="dt">"topology/ubiquitin.itp"</span></span>
<span id="annotated-cell-24-16"><a href="#annotated-cell-24-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-24-17"><a href="#annotated-cell-24-17" aria-hidden="true" tabindex="-1"></a><span class="kw">[ compartments ]</span></span>
<span id="annotated-cell-24-18"><a href="#annotated-cell-24-18" aria-hidden="true" tabindex="-1"></a><span class="dt">membrane from "membrane_mask.npz"</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-24" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-24-19" class="code-annotation-target"><a href="#annotated-cell-24-19" aria-hidden="true" tabindex="-1"></a><span class="dt">A from "A_mask.npz"</span></span>
<span id="annotated-cell-24-20"><a href="#annotated-cell-24-20" aria-hidden="true" tabindex="-1"></a><span class="dt">B from "B_mask.npz"</span></span>
<span id="annotated-cell-24-21"><a href="#annotated-cell-24-21" aria-hidden="true" tabindex="-1"></a><span class="dt">membrane-neighborhood around 4 of membrane</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-24" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-24-22" class="code-annotation-target"><a href="#annotated-cell-24-22" aria-hidden="true" tabindex="-1"></a><span class="dt">B-close-to-membrane combines membrane-neighborhood and B</span></span>
<span id="annotated-cell-24-23"><a href="#annotated-cell-24-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-24-24"><a href="#annotated-cell-24-24" aria-hidden="true" tabindex="-1"></a><span class="kw">[ segments ]</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-24" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-24-25" class="code-annotation-target"><a href="#annotated-cell-24-25" aria-hidden="true" tabindex="-1"></a><span class="dt">LYZ:lyz 200 from "structures/lysozyme.pdb" in A</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-24" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-24-26" class="code-annotation-target"><a href="#annotated-cell-24-26" aria-hidden="true" tabindex="-1"></a><span class="dt">UBQ:ubq 100 from "structures/ubiquitin.pdb" in B-close-to-membrane</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-24" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-24" data-code-lines="19" data-code-annotation="1">Added the <strong>A</strong> and <strong>B</strong> compartments.</span>
</dd>
<dt data-target-cell="annotated-cell-24" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-24" data-code-lines="22" data-code-annotation="2">Created a compartment demonstrating how combinations can include boolean operations between previously defined compartments.</span>
</dd>
<dt data-target-cell="annotated-cell-24" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-24" data-code-lines="25" data-code-annotation="3">Place lysozyme only in the <strong>A</strong> compartment.</span>
</dd>
<dt data-target-cell="annotated-cell-24" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-24" data-code-lines="26" data-code-annotation="4">Place ubiquitin only in the <strong>B</strong> compartment <em>and</em> close to the membrane.</span>
</dd>
</dl>
</section>
<section id="pack-the-system-2" class="level4">
<h4 class="anchored" data-anchor-id="pack-the-system-2">Pack the system</h4>
<p>Pack our multi-compartment system.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb22"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="ex">bentopy-pack</span> compartment_packing.bent placements.json</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="render-and-merge-1" class="level4">
<h4 class="anchored" data-anchor-id="render-and-merge-1">Render and merge</h4>
<p>Now we render and merge our structures like before.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb23"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">bentopy-render</span> placements.json packed_proteins.gro <span class="at">-t</span> topol.top</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge proteins with membrane structure</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="ex">bentopy-merge</span> packed_proteins.gro structures/double_membrane.gro <span class="at">-o</span> system.gro</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"POPC    10816"</span> <span class="op">&gt;&gt;</span> topol.top  <span class="co"># Add lipid molecules to the topology file.</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="solvation-2" class="level4">
<h4 class="anchored" data-anchor-id="solvation-2">Solvation</h4>
<p>Add water and ions to complete the system preparation.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb24"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">bentopy-solvate</span> <span class="at">-i</span> system.gro <span class="at">-o</span> solvated_system.gro <span class="at">-t</span> topol.top <span class="dt">\</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">-s</span> NA:0.15M <span class="at">-s</span> CL:0.15M <span class="at">--charge</span> neutral</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="visualization-and-final-analysis" class="level4">
<h4 class="anchored" data-anchor-id="visualization-and-final-analysis">Visualization and final analysis</h4>
<p>We can now inspect our final system.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb25"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="ex">vmd</span> solvated_system.gro</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The result should be similar to the snapshot shown below, you can observe:</p>
<ul>
<li>The lysozyme proteins are distributed throughout compartment <strong>A</strong>.</li>
<li>The Ubiquitin proteins are concentrated near the membrane surfaces in compartment <strong>B</strong>.</li>
<li>No protein overlaps with the membrane structure.</li>
</ul>
<div id="fig-tutorial-3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-tutorial-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figure_tutorial_3.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-tutorial-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Multi-compartment double membrane system. The double membrane creates two distinct open compartments. Ubiquitin (blue) is confined to one compartment between the membranes (<strong>A</strong>), while lysozyme (green) is placed only in the other compartment (<strong>B</strong>).
</figcaption>
</figure>
</div>
</section>
<section id="run-a-simulation" class="level4">
<h4 class="anchored" data-anchor-id="run-a-simulation">Run a simulation</h4>
<p>With the complete solvated system, you can now run a molecular dynamics simulation using the provided input files.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb26"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Energy minimization</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="ex">gmx</span> grompp <span class="at">-f</span> mdp_files/em.mdp <span class="at">-c</span> solvated_system.gro <span class="at">-p</span> topol.top <span class="at">-o</span> em.tpr</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="ex">gmx</span> mdrun <span class="at">-v</span> <span class="at">-deffnm</span> em</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Make index file</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="ex">gmx</span> make_ndx <span class="at">-f</span> em.gro <span class="at">-o</span> index.ndx <span class="op">&lt;&lt; EOF</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="st">name 13 Lipid</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="st">r W | r ION</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="st">name 16 Solvent</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="st">q</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="op">EOF</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Equilibration</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="ex">gmx</span> grompp <span class="at">-f</span> mdp_files/eq.mdp <span class="at">-c</span> em.gro <span class="at">-p</span> topol.top <span class="at">-o</span> eq.tpr <span class="at">-n</span> index.ndx</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="ex">gmx</span> mdrun <span class="at">-v</span> <span class="at">-deffnm</span> eq</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Production run</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="ex">gmx</span> grompp <span class="at">-f</span> mdp_files/md.mdp <span class="at">-c</span> eq.gro <span class="at">-p</span> topol.top <span class="at">-o</span> md.tpr <span class="at">-n</span> index.ndx</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="ex">gmx</span> mdrun <span class="at">-v</span> <span class="at">-deffnm</span> md</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You‚Äôve now walked through the complete <em>bentopy</em> workflow from simple packing to a complex MD model!</p>
<p>Through these three tutorials, you‚Äôve learned how <em>bentopy</em> can help you build complex molecular models with a well-structured workflow. This approach enables researchers to construct everything from crowded cytoplasm to whole-cell models with multiple compartments. The strength of <em>bentopy</em> lies in its ability to handle this complexity efficiently, making large-scale modeling accessible without sacrificing the molecular detail needed for accurate biological representation.</p>
<div id="fig-workflow" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-workflow-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figure_overview.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-workflow-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Bentopy workflow overview. Models are built in multiple consecutive steps including mask preparation, packing configuration, structure rendering, merging, and solvation.
</figcaption>
</figure>
</div>
</section>
</section>
<section id="Advanced_Features_and_Tips" class="level3">
<h3 class="anchored" data-anchor-id="Advanced_Features_and_Tips">Advanced Features and Tips</h3>
<hr>
<p>For people who are interested in learning more about <em>bentopy</em>, the <a href="https://github.com/marrink-lab/bentopy/wiki"><em>bentopy</em> wiki</a> is an excellent resource as well. This includes a <a href="https://github.com/marrink-lab/bentopy/wiki/Reference-for-bent">reference document</a> for the <code>bent</code> file format and some other example systems.</p>
<section id="solvation-options" class="level4">
<h4 class="anchored" data-anchor-id="solvation-options">Solvation options</h4>
<p><em>Bentopy</em> includes <code>bentopy-solvate</code>, a solvation tool optimized for large-scale systems. For the complete documentation, see the <a href="https://github.com/marrink-lab/bentopy/blob/main/src/solvate/README.md"><code>bentopy-solvate</code> README</a>.</p>
<section id="ion-substitutions-with-different-quantities" class="level5">
<h5 class="anchored" data-anchor-id="ion-substitutions-with-different-quantities">Ion substitutions with different quantities</h5>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb27"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Molarity: 150 mM NaCl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="ex">bentopy-solvate</span> <span class="at">-i</span> system.gro <span class="at">-o</span> solvated.gro <span class="at">-s</span> NA:0.15M <span class="at">-s</span> CL:0.15M</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fixed number: exactly 100 Na‚Å∫ and 100 Cl‚Åª ions.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="ex">bentopy-solvate</span> <span class="at">-i</span> system.gro <span class="at">-o</span> solvated.gro <span class="at">-s</span> NA:100 <span class="at">-s</span> CL:100</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Ratio: replace 1% of water with Na‚Å∫ ions.</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="ex">bentopy-solvate</span> <span class="at">-i</span> system.gro <span class="at">-o</span> solvated.gro <span class="at">-s</span> NA:0.01</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="set-custom-cutoff-distances" class="level5">
<h5 class="anchored" data-anchor-id="set-custom-cutoff-distances">Set custom cutoff distances</h5>
<p>For models with compartments, fine-tuning the number of water beads in the compartments is crucial for achieving a well-solvated model. The <code>--cutoff</code> flag controls the minimum distance between solvent and structure beads, allowing you to adjust the water bead placement. Increasing the cutoff creates more space around solutes (fewer water molecules), while decreasing it allows tighter packing (more water molecules). Additionally, the <code>--solvent-cutoff</code> flag is available to set the minimum allowable solvent‚Äìsolvent distance over the periodic boundary conditions.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb28"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="ex">bentopy-solvate</span> <span class="at">-i</span> system.gro <span class="at">-o</span> solvated.gro <span class="at">--cutoff</span> 0.5 <span class="at">--solvent-cutoff</span> 0.25</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="all-atom-waters" class="level5">
<h5 class="anchored" data-anchor-id="all-atom-waters">All-atom waters</h5>
<p>You can also use <code>bentopy-solvate</code> for atomistic models by setting <code>--water-type tip3p</code>. When you switch water types, the default solvent‚Äìstructure collision distance updated too.</p>
</section>
</section>
<section id="render-options-for-large-systems" class="level4">
<h4 class="anchored" data-anchor-id="render-options-for-large-systems">Render options for large systems</h4>
<p>For large systems, <code>bentopy-render</code> provides several options to manage visualization and analysis:</p>
<section id="limiting-render-regions" class="level5">
<h5 class="anchored" data-anchor-id="limiting-render-regions">Limiting render regions</h5>
<p>Render only a specific region using <code>--limits</code> (format: <code>minx,maxx,miny,maxy,minz,maxz</code>):</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb29"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Render a 10√ó10√ó10 nm cube from (40,40,40) to (50,50,50)</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="ex">bentopy-render</span> placements.json small_region.gro <span class="at">--limits</span> 40,50,40,50,40,50</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Render a thin slice in z-direction only</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="ex">bentopy-render</span> placements.json slice.gro <span class="at">--limits</span> none,none,none,none,45,55</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="reduced-atom-rendering" class="level5">
<h5 class="anchored" data-anchor-id="reduced-atom-rendering">Reduced atom rendering</h5>
<p>Use <code>--mode</code> to render fewer atoms for easier visualization:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb30"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Render only alpha carbons</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="ex">bentopy-render</span> placements.json alpha_only.gro <span class="at">--mode</span> alpha</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Render one bead per residue</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="ex">bentopy-render</span> placements.json residue_beads.gro <span class="at">--mode</span> residue</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Render one bead per protein instance</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="ex">bentopy-render</span> placements.json instance_beads.gro <span class="at">--mode</span> instance</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Reduced rendering modes cannot generate topology files, since these are only intended for visualization and validation. Use <code>--mode full</code> (default) when topology files are needed.</p>
</div>
</div>
</section>
<section id="residue-numbering-control" class="level5">
<h5 class="anchored" data-anchor-id="residue-numbering-control">Residue numbering control</h5>
<p>Control how residue numbers are assigned using <code>--resnum-mode</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb31"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Each protein instance gets unique residue number</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="ex">bentopy-render</span> placements.json system.gro <span class="at">--resnum-mode</span> instance</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># All instances of same protein type get same residue number</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="ex">bentopy-render</span> placements.json system.gro <span class="at">--resnum-mode</span> segment</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="residue-name-relabeling" class="level5">
<h5 class="anchored" data-anchor-id="residue-name-relabeling">Residue name relabeling</h5>
<p>Assign custom residue names when merging files for better organization and visualization:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb32"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign custom residue names using the colon syntax.</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="ex">bentopy-merge</span> membrane.gro:MEM packed_proteins.gro:PROT <span class="at">-o</span> complete_system.gro</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="ex">bentopy-merge</span> membrane.gro:MEM cytosol.gro:CYT chromosome.gro:CHR <span class="at">-o</span> cell.gro</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This allows easy selection and visualization of different system components in molecular viewers.</p>
</section>
</section>
<section id="configuration-options" class="level4">
<h4 class="anchored" data-anchor-id="configuration-options">Configuration options</h4>
<section id="example-configuration-for-starting-new-projects" class="level5">
<h5 class="anchored" data-anchor-id="example-configuration-for-starting-new-projects">Example configuration for starting new projects</h5>
<p>If you are starting a new project with <em>bentopy</em>, it may be helpful to have a jumping-off point for the configuration file. You can generate an example input file as follows.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb33"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="ex">bentopy-init</span> example <span class="at">-o</span> input.bent</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This example lists and explains many of the available options with placeholders to be filled in with relevant values.</p>
</section>
<section id="convert-legacy-.json-input-files-to-the-new-format-.bent" class="level5">
<h5 class="anchored" data-anchor-id="convert-legacy-.json-input-files-to-the-new-format-.bent">Convert legacy (<code>.json</code>) input files to the new format (<code>.bent</code>)</h5>
<p>Early adopters of <em>bentopy</em> may still have <code>.json</code> input files. These can be converted to <code>.bent</code> files using <code>bentopy-init</code>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb34"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="ex">bentopy-init</span> convert <span class="at">-i</span> input.json <span class="at">-o</span> output.bent</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This command can also be used to convert from <code>.bent</code> to <code>.bent</code>, in essence functioning as a formatter. Note that this will strip any comments.</p>
</section>
<section id="validate-input-files" class="level5">
<h5 class="anchored" data-anchor-id="validate-input-files">Validate input files</h5>
<p>Input configuration files can be checked for errors and potential problems using the <code>validate</code> subcommand.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb35"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="ex">bentopy-init</span> validate <span class="at">-i</span> input.bent</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="formatting-.bent-files" class="level5">
<h5 class="anchored" data-anchor-id="formatting-.bent-files">Formatting <code>.bent</code> files</h5>
<p>The parser for the input files is very flexible, allowing almost arbitrary whitespace between the keywords in any declaration. This may sound inconsequential, but it allows for formatting input files in ways that suit readability concerns or preferences.</p>
<p>For instance, long segment definitions can be neatly written over multiple lines.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb36"><pre class="sourceCode ini code-with-copy"><code class="sourceCode ini"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[ segments ]</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="dt">LYZ:lyz</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="dt">    0.5mM</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="dt">    from "long/structures/path/lysozyme.pdb"</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="dt">    in long, list, of, compartments</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="dt">    satisfies even, some, constraints</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="using-concentrations-instead-of-fixed-copy-numbers" class="level5">
<h5 class="anchored" data-anchor-id="using-concentrations-instead-of-fixed-copy-numbers">Using concentrations instead of fixed copy numbers</h5>
<p>Instead of absolute copy numbers, it is also possible to provide molar concentrations (in mol/L).</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb37"><pre class="sourceCode ini code-with-copy"><code class="sourceCode ini"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[ segments ]</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="dt">LYZ 5.0mM from "structures/lysozyme.pdb" in system</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="controlling-protein-rotations" class="level5">
<h5 class="anchored" data-anchor-id="controlling-protein-rotations">Controlling protein rotations</h5>
<p>Constrain or set initial rotations for more realistic placement.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb38"><pre class="sourceCode ini code-with-copy"><code class="sourceCode ini"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[ constraints ]</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Only rotate over the z-axis.</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="dt">planar rotates z</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="kw">[ segments ]</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="dt">LYZ 50 from "structures/lysozyme.pdb" in system satisfies planar</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The <code>rotates</code> constraint takes a comma-separated list of axes along which random rotations may be applied between different placements.</p>
</section>
<section id="compartment-combinations" class="level5">
<h5 class="anchored" data-anchor-id="compartment-combinations">Compartment combinations</h5>
<p>Create complex spaces using boolean operations on compartments.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb39"><pre class="sourceCode ini code-with-copy"><code class="sourceCode ini"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[ compartments ]</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="dt">a as sphere at  7.5, 10, 10 with radius 7.5</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="dt">b as sphere at 12.5, 10, 10 with radius 7.5</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="dt">c combines a and b</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="dt">d combines not c</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="dt">e combines a or not (b or d)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>These <em>combination expressions</em> can be nested and combined again. The following syntax elements are available.</p>
<dl>
<dt><code>not &lt;expr&gt;</code></dt>
<dd>
Gives the inverse of <code>&lt;expr&gt;</code>.
</dd>
<dt><code>&lt;expr&gt; and &lt;expr&gt;</code></dt>
<dd>
Gives the intersection between two expressions.
</dd>
<dt><code>&lt;expr&gt; or &lt;expr&gt;</code></dt>
<dd>
Gives the union of two expressions.
</dd>
<dt><code>( &lt;expr&gt; )</code></dt>
<dd>
Group expressions.
</dd>
</dl>
</section>
</section>
<section id="command-line-tips" class="level4">
<h4 class="anchored" data-anchor-id="command-line-tips">Command line tips</h4>
<section id="inspect-placement-lists" class="level5">
<h5 class="anchored" data-anchor-id="inspect-placement-lists">Inspect placement lists:</h5>
<p>Use <code>jq</code> to view placement files in a pretty-printed, readable format. Placement lists are not meant to be inspected directly, but it may be interesting to take a look. The placement list stores the translations and rotations for all instances of each segment. Also note that any important settings for reproducing a placement list, such as its seed, rearrange-method, or max-tries-mult are also stored in its header.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb40"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="ex">jq</span> . placements.json</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
<section id="troubleshooting-common-issues" class="level4">
<h4 class="anchored" data-anchor-id="troubleshooting-common-issues">Troubleshooting common issues</h4>
<section id="packing-failures" class="level5">
<h5 class="anchored" data-anchor-id="packing-failures">Packing failures</h5>
<ul>
<li>Check <em>bentopy</em>‚Äôs packing summary output to see which segments failed.</li>
<li>Use the <code>--verbose</code> flag of <code>bentopy-pack</code> for detailed information on the packing process. Double-check molecule counts/concentrations against available space. Use the <code>max-tries-mult &lt;number&gt;</code> declaration in the <em>general</em> section of the <code>.bent</code> file to increase the number of placement attempts. The default value is 1000.</li>
</ul>
</section>
<section id="mask-problems" class="level5">
<h5 class="anchored" data-anchor-id="mask-problems">Mask problems</h5>
<ul>
<li>Ensure mask dimensions match <em>space dimensions</em> √∑ <em>resolution</em>.</li>
<li>Use the <code>-b</code> (or <code>--visualize-labels</code>) flag of <code>bentopy-mask</code> to output a <code>gro</code> visualization file for the voxel representation of the identified compartments.</li>
<li>Try different <em>containment/mask resolutions</em> if too many compartments are identified.</li>
<li>The <code>--morph</code> flag can be used to ‚Äòrepair‚Äô holes that might undesirably connect seperate compartments, even at finer <em>containment resolutions</em>. By default, it has the value <code>de</code>, which means ‚Äò<strong>d</strong>ilate then <strong>e</strong>rode‚Äô. This is equivalent to a <a href="https://en.wikipedia.org/wiki/Closing_(morphology)">morphological closing</a> operation.</li>
<li>Morphing can be disabled entirely using the <code>--no-morph</code> flag.</li>
</ul>
</section>
<section id="rendering-errors" class="level5">
<h5 class="anchored" data-anchor-id="rendering-errors">Rendering errors</h5>
<ul>
<li>Verify all structure paths in placement list are accessible. If you are rendering in a different location than where the packing took place, the <code>--root &lt;path&gt;</code> option may be helpful. It sets the location from where the input structure paths will be resolved.</li>
<li>Check structure file formats (<code>pdb</code> and <code>gro</code> files are supported for input structures).</li>
</ul>
</section>
<section id="topology-issues" class="level5">
<h5 class="anchored" data-anchor-id="topology-issues">Topology issues</h5>
<ul>
<li>Ensure segment names in the <code>.bent</code> file match molecule names in the <code>.itp</code> files. Use tags to distinguish different segments of the same structure.</li>
<li>Verify all <code>.itp</code> files listed in <code>topol_includes</code> exist and contain the expected topology information.</li>
</ul>
<p>For additional support, examples, and updates, visit the <a href="https://github.com/marrink-lab/bentopy">bentopy GitHub repository</a>.</p>



</section>
</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-bruininks_mdvcontainment_2025" class="csl-entry" role="listitem">
Bruininks, Bart M. H., &amp; Vattulainen, Ilpo. (2025). Classification of containment hierarchy for point clouds in periodic space. <em>bioRxiv</em>. <a href="https://doi.org/10.1101/2025.08.06.668936">https://doi.org/10.1101/2025.08.06.668936</a>
</div>
<div id="ref-westendorp_bentopy_2026" class="csl-entry" role="listitem">
Westendorp, Marieke S. S., Stevens, Jan A., Brown, Chelsea M., Dommer, Abigail C., Wassenaar, Tsjerk A., Bruininks, Bart M. H., &amp; Marrink, Siewert J. (2026). Compartment-guided assembly of large-scale molecular models with bentopy. <em>Protein Science</em>, e70480. <a href="https://doi.org/10.1002/pro.70480">https://doi.org/10.1002/pro.70480</a>
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/cgmartini\.nl");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<div class="footer-left">

</div>
</div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Martini-Force-Field-Initiative">
      <i class="bi bi-github" role="img" aria-label="Martini GitHub">
</i> 
    </a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="../../../../docs/faq/index.html">
<p><iconify-icon inline="true" role="img" icon="hugeicons:help-circle" style="font-size: 1.25em;" aria-label="FAQs" title="FAQs"></iconify-icon></p>
</a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/cg_martini">
      <i class="bi bi-twitter-x" role="img" aria-label="Martini Twitter">
</i> 
    </a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
<div class="footer-right">
¬© 2025 Martini Force Field Initiative <img src="https://cgmartini-library.s3.ca-central-1.amazonaws.com/icon.png" alt="Icon">
</div>
</div>
  </div>
</footer>
<script>
    document.addEventListener('DOMContentLoaded', (event) => {
      const quotes = [
          "<i>Shaken, not stirred.</i> - James Bond",
          "<i>He was white and shaken, like a dry martini.</i> - P. G. Wodehouse",      
          "<i>I think people think we're all sipping martinis by the pool.</i> - Maria Menounos",
          "<i>Why don't you get out of that wet coat and into a dry martini?</i> - Robert Benchley",
          "<i>Really, can anyone drink several martinis at lunch?</i> - Christine Baranski",
          "<i>Zen martini: A martini with no vermouth at all. And no gin, either.</i> - P.J. O'Rourke",
          "<i>I never go jogging, it makes me spill my martini.</i> - George Burns",
          "<i>Martinis are the only American invention as perfect as a sonnet.</i> - H. L. Mencken",
          "<i>He knows just how I like my martini: full of alcohol.</i> - Homer Simpson",
          "<i>Happiness is: finding olives in your martini when you're hungry.</i> - Johnny Carson",
          "<i>If it wasn't for the olives in his martinis he'd starve to death.</i> - Milton Berle",
        ];
      const randomIndex = Math.floor(Math.random() * quotes.length);
      const randomQuote = quotes[randomIndex];

      const footerLeft = document.querySelector('.footer-left');
      if (footerLeft) {
          footerLeft.innerHTML = randomQuote;
      }
    });
</script>
<script src="../../../../js/sidebar-close.js"></script> 




</body></html>